<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡πÄ‡∏ó‡∏°‡πÄ‡∏û‡∏•‡∏ï‡∏ã‡∏≠‡∏á‡∏à‡∏î‡∏´‡∏°‡∏≤‡∏¢</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            /* --- Color Scheme matching choompoo.html --- */
            --bg-color: #F8F6FF;         /* ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏´‡∏•‡∏±‡∏Å */
            --primary-text: #8B5DFF;     /* ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏•‡∏±‡∏Å */
            --darker-text: #6A3ED4;      /* ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏Ç‡πâ‡∏° */
            --primary-accent: #B794F6;   /* ‡∏™‡∏µ‡πÄ‡∏ô‡πâ‡∏ô */
            --envelope-light: #E6D8FF;   /* ‡∏™‡∏µ‡∏ã‡∏≠‡∏á‡∏≠‡πà‡∏≠‡∏ô */
            --envelope-dark: #9B6BFF;    /* ‡∏™‡∏µ‡∏ã‡∏≠‡∏á‡πÄ‡∏Ç‡πâ‡∏° */
            --letter-text: #2D3748;      /* ‡∏™‡∏µ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÉ‡∏ô‡∏à‡∏î‡∏´‡∏°‡∏≤‡∏¢ (‡πÄ‡∏ó‡∏≤‡πÄ‡∏Ç‡πâ‡∏°) */
            --letter-title: #1A202C;     /* ‡∏™‡∏µ‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡πÉ‡∏ô‡∏à‡∏î‡∏´‡∏°‡∏≤‡∏¢ (‡πÄ‡∏ó‡∏≤‡πÄ‡∏Ç‡πâ‡∏°‡∏°‡∏≤‡∏Å) */
            --letter-signature: #553C9A; /* ‡∏™‡∏µ‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô (‡∏°‡πà‡∏ß‡∏á‡πÄ‡∏Ç‡πâ‡∏°) */
        }
        
        body {
            font-family: 'Kanit', sans-serif;
            overflow: hidden;
            background-color: #F8F6FF;
        }
        
        /* --- Transitions --- */
        #transition-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background-color: #000;
            opacity: 0;
            pointer-events: none;
            z-index: 9999;
            transition: opacity 0.8s ease-in-out;
        }
        .view {
            transition: opacity 0.5s ease-in-out, transform 0.5s ease-in-out;
            position: absolute;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .view.hidden {
            opacity: 0;
            pointer-events: none;
        }

        /* --- Start Screen --- */
        #start-button {
            transition: transform 0.2s, box-shadow 0.2s;
        }
        #start-button:hover {
            transform: translateY(-4px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }

        /* --- Envelope Design --- */
        .envelope-wrapper {
            perspective: 1000px;
            position: relative;
        }
        .envelope {
            position: relative;
            width: 300px;
            height: 200px;
            cursor: pointer;
            transition: transform 0.5s;
            filter: drop-shadow(0 10px 8px rgba(0,0,0,0.1));
        }
        .envelope:hover {
            transform: translateY(-10px) scale(1.03);
        }
        .envelope.open .top-flap {
            transform: rotateX(180deg);
        }
       
        /* Envelope Parts */
        .envelope .flap {
            position: absolute;
        }
        .envelope .left-flap {
            top: 0; left: 0; width: 155px; height: 200px;
            background-image: linear-gradient(to bottom right, var(--primary-accent), var(--primary-text));
            clip-path: polygon(100% 0, 0 50%, 100% 100%);
            z-index: 2;
        }
        .envelope .right-flap {
            top: 0; right: 0; width: 155px; height: 200px;
            background-image: linear-gradient(to bottom left, var(--primary-accent), var(--primary-text));
            clip-path: polygon(0 0, 100% 50%, 0 100%);
            z-index: 2;
        }
        .envelope .bottom-flap {
            bottom: 0; left: 0; width: 300px; height: 105px;
            background-image: linear-gradient(to top, var(--primary-accent), var(--primary-text));
            clip-path: polygon(0 0, 100% 0, 50% 100%);
            z-index: 2;
        }
        .envelope .top-flap {
            top: 0; left: 0; width: 100%; height: 105px;
            background-image: linear-gradient(to bottom, var(--primary-text), var(--darker-text));
            clip-path: polygon(0 0, 100% 0, 50% 100%);
            transform-origin: top;
            transition: transform 0.8s ease-in-out;
            z-index: 5;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        .envelope .front-panel {
            top: 0; left: 0; width: 100%; height: 100%;
            background-color: var(--envelope-light);
            border-radius: 8px;
            z-index: 4;
            box-shadow: inset 0 0 15px rgba(0,0,0,0.1);
        }
        .envelope .seal {
            position: absolute;
            top: 85px;
            left: 50%;
            transform: translateX(-50%);
            width: 30px;
            height: 30px;
            background: var(--envelope-light);
            border: 1px solid var(--darker-text);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            z-index: 6;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
            transition: opacity 0.5s;
        }
        .envelope.open .seal {
            opacity: 0;
        }

        /* --- Letter Inside Envelope --- */
        .letter-inside {
            position: absolute;
            width: 260px;
            height: 180px;
            top: 15px;
            left: 20px;
            background: linear-gradient(135deg, #ffffff 0%, #faf9ff 100%);
            border: 1px solid var(--envelope-light);
            border-radius: 6px;
            box-shadow: 0 2px 8px rgba(139, 93, 255, 0.15);
            z-index: 3;
            transform: translateY(0) scale(0.85);
            transition: none;
            padding: 15px;
            box-sizing: border-box;
            opacity: 0;
        }

        /* Letter animations */
        @keyframes letter-slide-out {
            0% { 
                transform: translateY(0) scale(0.85);
                opacity: 0;
            }
            30% { 
                opacity: 0.7;
            }
            70% { 
                transform: translateY(-150px) scale(0.85);
                opacity: 0.9;
            }
            100% { 
                transform: translateY(-200px) scale(0.85);
                opacity: 1;
            }
        }

        @keyframes letter-expand-center {
            0% { 
                transform: translateY(-200px) scale(0.85);
                opacity: 1;
            }
            100% { 
                transform: translate(-50%, -40%) scale(1.2);
                left: 50%;
                top: 60%;
                width: 400px;
                height: 500px;
                z-index: 10;
                opacity: 1;
            }
        }

        @keyframes letter-shrink-back {
            0% { 
                transform: translate(-50%, -40%) scale(1.2);
                left: 50%;
                top: 60%;
                width: 400px;
                height: 500px;
                z-index: 10;
                opacity: 1;
            }
            100% { 
                transform: translateY(-200px) scale(0.85);
                left: 20px;
                top: 15px;
                width: 260px;
                height: 180px;
                z-index: 4;
                opacity: 1;
            }
        }

        @keyframes letter-slide-in {
            0% { 
                transform: translateY(-200px) scale(0.85);
                opacity: 1;
            }
            30% { 
                transform: translateY(-150px) scale(0.85);
                opacity: 0.9;
            }
            70% { 
                opacity: 0.7;
            }
            100% { 
                transform: translateY(0) scale(0.85);
                opacity: 0;
            }
        }

        .letter-sliding-out {
            animation: letter-slide-out 1.2s cubic-bezier(0.4, 0, 0.2, 1) forwards;
        }

        .letter-expanding {
            animation: letter-expand-center 1s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards;
        }

        .letter-shrinking {
            animation: letter-shrink-back 1s cubic-bezier(0.55, 0.06, 0.68, 0.19) forwards;
        }

        .letter-sliding-in {
            animation: letter-slide-in 1.2s cubic-bezier(0.8, 0, 0.6, 1) forwards;
        }

        /* --- Letter Content Animation --- */
        .letter-part {
            opacity: 0;
            transform: translateY(20px);
            transition: opacity 0.8s ease-out, transform 0.8s ease-out;
        }

        .letter-part.visible {
            opacity: 1;
            transform: translateY(0);
        }

        .letter-part.scroll-up {
            animation: scroll-up 0.8s ease-out forwards;
        }

        @keyframes scroll-up {
            0% {
                opacity: 1;
                transform: translateY(0);
            }
            100% {
                opacity: 0;
                transform: translateY(-30px);
            }
        }

        /* --- Pop-up --- */
        #popup-message {
            transition: opacity 0.5s ease-in-out, transform 0.5s ease-in-out;
            text-shadow: 2px 2px 8px rgba(0,0,0,0.5);
        }

        /* --- Thought View Styles --- */
        #thought-view {
            background-color: #F8F6FF;
            position: relative;
        }

        /* Typewriter effect */
        .typewriter {
            overflow: hidden;
            white-space: nowrap;
            border-right: 3px solid var(--primary-text);
            animation: typing 3s steps(50, end), blink-caret 0.75s step-end infinite;
            max-width: 100%;
            text-align: center;
        }

        .typewriter.no-caret {
            border-right: none;
        }

        @keyframes typing {
            from { width: 0; }
            to { width: 100%; }
        }

        @keyframes blink-caret {
            from, to { border-color: transparent; }
            50% { border-color: var(--primary-text); }
        }

        /* Floating particles */
        .particle {
            position: absolute;
            pointer-events: none;
            opacity: 0.6;
            font-size: 12px;
            animation: float-particle 8s linear infinite;
        }

        @keyframes float-particle {
            0% {
                transform: translateY(100vh) rotate(0deg);
                opacity: 0;
            }
            10% {
                opacity: 0.6;
            }
            90% {
                opacity: 0.6;
            }
            100% {
                transform: translateY(-100px) rotate(360deg);
                opacity: 0;
            }
        }

        /* Heart particles */
        .heart-particle {
            position: absolute;
            pointer-events: none;
            font-size: 16px;
            color: #FF69B4;
            animation: float-heart 3s ease-out forwards;
        }

        @keyframes float-heart {
            0% {
                transform: translateY(0) scale(1);
                opacity: 1;
            }
            100% {
                transform: translateY(-200px) scale(0.3);
                opacity: 0;
            }
        }

        /* Thought text animations */
        #thought-text {
            transition: opacity 0.8s ease-in-out, transform 0.8s ease-in-out;
            text-shadow: 1px 1px 3px rgba(139, 93, 255, 0.1);
            font-family: 'Kanit', sans-serif;
            font-weight: 400;
        }

        .fade-in-thought {
            animation: fade-in-up 1.2s ease-out forwards;
        }

        .fade-out-thought {
            animation: fade-out-down 0.8s ease-in forwards;
        }

        @keyframes fade-in-up {
            0% {
                opacity: 0;
                transform: translateY(30px);
            }
            100% {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fade-out-down {
            0% {
                opacity: 1;
                transform: translateY(0);
            }
            100% {
                opacity: 0;
                transform: translateY(-30px);
            }
        }

        /* Breathing effect for special thoughts */
        .breathing {
            animation: breathe 3s ease-in-out infinite;
        }

        @keyframes breathe {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        /* Soft glow effect */
        .soft-glow {
            text-shadow: 0 0 20px rgba(139, 93, 255, 0.3), 
                         0 0 40px rgba(139, 93, 255, 0.2),
                         1px 1px 3px rgba(139, 93, 255, 0.1);
        }

    </style>
</head>
<body style="background-color: #F8F6FF;">

    <div id="transition-overlay"></div>

    <!-- Pop-up Message -->
    <div id="popup-message" class="fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 text-white text-2xl font-semibold opacity-0 pointer-events-none z-50 transform scale-90" style="color: var(--primary-text); text-shadow: 2px 2px 8px rgba(139, 93, 255, 0.5);">
        <span>‡∏õ‡∏¥‡∏î‡∏à‡∏î‡∏´‡∏°‡∏≤‡∏¢‡πÅ‡∏•‡πâ‡∏ß</span>
    </div>

    <!-- Start Screen -->
    <div id="start-screen" class="view text-center">
        <button id="start-button" class="font-bold py-3 px-8 rounded-full text-lg shadow-lg text-white transition-transform transition-shadow duration-200" style="background-color: var(--primary-text);" onmouseover="this.style.backgroundColor='var(--darker-text)'" onmouseout="this.style.backgroundColor='var(--primary-text)'">
            ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏•‡∏¢!
        </button>
    </div>

    <!-- Envelope View -->
    <div id="envelope-view" class="view hidden text-center flex-col items-center justify-center">
        <div class="envelope-wrapper">
            <div id="envelope" class="envelope">
                <div class="flap left-flap"></div>
                <div class="flap right-flap"></div>
                <div class="flap bottom-flap"></div>
                <div class="flap front-panel"></div>
                
                <!-- Letter inside envelope -->
                <div id="letter-inside" class="letter-inside">
                    <div class="text-center">
                        <h1 class="text-2xl font-bold mb-3 tracking-tight" style="color: var(--letter-title);">
                            [‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á]
                        </h1>
                    </div>
                    <div class="text-left mt-3" id="letter-content">
                        <!-- Content will be dynamically inserted here -->
                    </div>
                    <div class="text-center mt-auto pt-3 absolute bottom-4 left-0 right-0">
                        <button id="close-button" class="mt-4 text-white font-bold py-2 px-4 rounded-full transition duration-300 shadow-md" style="background-color: var(--primary-text);" onmouseover="this.style.backgroundColor='var(--darker-text)'" onmouseout="this.style.backgroundColor='var(--primary-text)'">
                            ‡∏õ‡∏¥‡∏î‡∏à‡∏î‡∏´‡∏°‡∏≤‡∏¢
                        </button>
                    </div>
                </div>
                
                <div class="flap top-flap"></div>
                <div class="seal">üíú</div>
            </div>
        </div>
        <p id="instruction" class="mt-12 text-lg font-semibold transition-opacity duration-500" style="color: var(--primary-text);">
            ‡∏ã‡∏≠‡∏á‡∏à‡∏î‡∏´‡∏°‡∏≤‡∏¢<br> <span class="text-sm font-normal">‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏¥‡∏î</span>
        </p>
    </div>

    <!-- Thought View -->
    <div id="thought-view" class="view hidden relative overflow-hidden" style="display: flex; align-items: center; justify-content: center; min-height: 100vh; width: 100vw;">
        <!-- Floating particles background -->
        <div id="particles-container" class="absolute inset-0 pointer-events-none">
            <!-- Particles will be generated here -->
        </div>
        
        <!-- Main thought content -->
        <div class="text-center max-w-4xl px-8 relative z-10" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);">
            <div id="thought-text" class="font-medium leading-relaxed" style="color: var(--primary-text); min-height: 1.5em; font-size: clamp(1.5rem, 5vw, 2.5rem); letter-spacing: 0.05em;">
                <!-- Thought text will appear here -->
            </div>
            
            <!-- Continue button (hidden initially) -->
            <button id="continue-button" class="text-white font-bold py-3 px-6 rounded-full transition duration-300 shadow-lg opacity-0 pointer-events-none" style="background-color: var(--primary-text); transform: scale(0.8); margin-top: 2rem;" onmouseover="this.style.backgroundColor='var(--darker-text)'" onmouseout="this.style.backgroundColor='var(--primary-text)'">
                ‡∏Å‡∏•‡∏±‡∏ö‡∏™‡∏π‡πà‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å
            </button>
        </div>
        
        <!-- Heart particles for special moments -->
        <div id="heart-container" class="absolute inset-0 pointer-events-none">
            <!-- Hearts will be generated here -->
        </div>
    </div>

    <script>
        // DOM Elements
        const transitionOverlay = document.getElementById('transition-overlay');
        const startScreen = document.getElementById('start-screen');
        const startButton = document.getElementById('start-button');
        const envelopeView = document.getElementById('envelope-view');
        const envelope = document.getElementById('envelope');
        const instruction = document.getElementById('instruction');
        const letterInside = document.getElementById('letter-inside');
        const closeButton = document.getElementById('close-button');
        const popupMessage = document.getElementById('popup-message');
        const letterContent = document.getElementById('letter-content');
        
        // Thought View Elements
        const thoughtView = document.getElementById('thought-view');
        const thoughtText = document.getElementById('thought-text');
        const thoughtIndicator = document.getElementById('thought-indicator');
        const continueButton = document.getElementById('continue-button');
        const particlesContainer = document.getElementById('particles-container');
        const heartContainer = document.getElementById('heart-container');
        
        let isOpened = false;
        let isAnimating = false;
        let currentPart = 0;
        let letterParts = [];
        let currentThought = 0;
        let thoughtParts = [];
        let isThinking = false;
        let typewriterTimeout;
        const allViews = document.querySelectorAll('.view');

        // Letter content - split into parts for long text
        const fullLetterText = `[‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà...]‡∏î‡∏Å‡πÄ
‡∏î‡∏Å‡πÄ‡∏î‡∏Å‡πÄ
‡∏Å‡∏î‡πÄ‡∏Å‡∏î‡πÄ‡πÄ‡πÄ‡πÄ‡πÄ‡πÄ
‡∏Å‡∏î‡πÄ‡∏î‡πÄ‡∏î‡πÄ‡∏î‡πÄ‡∏î‡πÄ‡∏î‡πÄ‡∏î‡πÄ‡∏î‡πÄ‡∏î‡πÄ‡∏î‡πÄ‡∏î‡πÄ‡∏î‡πÄ‡∏î‡πÄ‡∏î‡πÄ‡∏î‡πÄ‡∏î‡πÄ
‡∏Å‡∏î‡πÄ‡∏î‡πÄ‡∏î‡πÄ‡∏î‡πÄ‡∏î‡πÄ‡∏î‡πÄ‡∏î‡πÄ‡∏î‡πÄ‡∏î‡πÄ‡∏î‡πÄ‡∏î‡πÄ‡∏î‡πÄ‡∏î‡πÄ‡∏î‡πÄ‡∏î‡πÄ‡∏î‡πÄ‡∏Å‡∏î‡πÄ‡∏Å‡∏î
‡∏î‡∏Å‡πÄ‡∏î‡∏Å‡πÄ‡∏î‡∏Å‡πÄ‡∏î‡∏Å‡πÄ‡∏î‡∏Å‡πÄ‡∏Å‡∏î
‡∏î‡∏Å‡πÄ‡∏Å‡∏î‡πÄ‡∏î‡∏Å‡πÄ‡∏î‡∏Å‡πÄ‡∏Å‡∏î‡πÄ‡∏Å‡∏î‡πÄ‡∏î‡∏Å
‡∏î‡∏Å‡πÄ‡∏î‡∏Å‡πÄ‡∏Å‡πÄ‡∏Å‡∏î‡∏î‡∏Å
‡∏´‡∏Å‡∏î‡∏Å‡∏´‡∏î‡∏´‡∏Å‡∏î‡∏´
‡∏´‡∏Å‡∏î‡∏´‡∏Å‡∏î‡∏´‡∏î‡∏´‡∏Å‡∏î
‡∏´‡∏Å‡∏î‡∏´‡∏Å‡∏î‡∏Å‡∏´‡∏î‡∏Å‡∏´‡∏î‡∏´
‡∏´‡∏Å‡∏î‡∏´‡∏Å‡∏î‡∏Å‡∏´‡∏î‡∏Å‡∏´‡∏î‡∏´‡∏´‡∏î
‡∏´‡∏Å‡∏î‡∏´‡∏Å‡∏î‡∏´‡∏Å‡∏î‡∏´‡∏Å‡∏î‡∏Å‡∏´‡∏î
‡∏´‡∏Å‡∏î‡∏´‡∏Å‡∏î‡∏´‡∏Å‡∏î‡∏´‡∏Å‡∏î‡∏Å‡∏´‡∏î‡∏Å‡∏´
‡∏Å‡∏´‡∏î‡∏´‡∏Å‡∏î‡∏Å‡∏´‡∏î‡∏´‡∏Å‡∏î‡∏Å‡∏´‡∏î
‡∏Å‡∏´‡∏î‡∏´‡∏Å‡∏î‡∏Å‡∏´‡∏î‡∏´‡∏Å‡∏î‡∏Å‡∏´‡∏î‡∏´
‡πÅ‡∏•‡∏∞‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏ß‡πÜ ‡∏ï‡πà‡∏≠‡πÑ‡∏õ‡∏≠‡∏µ‡∏Å‡∏°‡∏≤‡∏Å‡∏°‡∏≤‡∏¢ ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏ö‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏≠‡∏á‡∏ó‡πà‡∏≠‡∏ô
‡πÉ‡∏´‡πâ‡∏î‡∏π‡∏ß‡πà‡∏≤‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏™dzsfsdfsdfsfsdf
sdfsdfsd
sdfsfsfsd
sdfsdfsdfsdf
dsfsdfsdfsdf
fsdfsdfsd‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Å‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏ß‡πÑ‡∏î‡πâ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÑ‡∏£
‡πÇ‡∏î‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ç‡∏∂‡πâ‡∏ô‡πÑ‡∏õ‡πÅ‡∏ö‡∏ö‡∏£‡∏≤‡∏ö‡∏£‡∏∑‡πà‡∏ô
‡πÅ‡∏•‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏≠‡∏á‡∏ï‡πà‡∏≠‡∏à‡∏≤‡∏Å‡∏™‡πà‡∏ß‡∏ô‡πÅ‡∏£‡∏Å‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏î‡∏ï‡∏≠‡∏ô`;

        // Thought content - the inner thoughts after reading the letter
        const thoughtMessages = [
            "‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡∏≠‡πà‡∏≤‡∏ô‡∏à‡∏î‡∏´‡∏°‡∏≤‡∏¢‡∏ô‡∏µ‡πâ‡πÅ‡∏•‡πâ‡∏ß... ‡∏â‡∏±‡∏ô‡∏£‡∏π‡πâ‡∏™‡∏∂‡∏Å‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÑ‡∏£",
            "‡∏Ñ‡∏≥‡∏û‡∏π‡∏î‡∏Ç‡∏≠‡∏á‡πÄ‡∏Ç‡∏≤‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏â‡∏±‡∏ô‡∏ô‡∏∂‡∏Å‡∏ñ‡∏∂‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏£‡∏á‡∏à‡∏≥‡∏î‡∏µ‡πÜ",
            "‡∏ö‡∏≤‡∏á‡∏ó‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡∏™‡∏∂‡∏Å‡∏ô‡∏µ‡πâ‡∏°‡∏±‡∏ô‡∏à‡∏∞‡∏Ñ‡∏á‡∏≠‡∏¢‡∏π‡πà‡πÑ‡∏õ‡∏ô‡∏≤‡∏ô‡πÅ‡∏Ñ‡πà‡πÑ‡∏´‡∏ô",
            "‡∏â‡∏±‡∏ô‡∏≠‡∏¢‡∏≤‡∏Å‡∏à‡∏∞‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö‡πÄ‡∏Ç‡∏≤‡∏ö‡πâ‡∏≤‡∏á‡πÑ‡∏´‡∏°‡∏ô‡∏∞...",
            "‡πÅ‡∏ï‡πà‡∏à‡∏∞‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏≠‡∏∞‡πÑ‡∏£‡∏î‡∏µ ‡πÉ‡∏´‡πâ‡∏ü‡∏±‡∏á‡∏î‡∏π‡πÑ‡∏°‡πà‡πÅ‡∏õ‡∏•‡∏Å‡πÜ",
            "‡πÄ‡∏≠‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏ß‡πà‡∏≤... ‡πÄ‡∏Å‡πá‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡∏™‡∏∂‡∏Å‡∏ô‡∏µ‡πâ‡πÑ‡∏ß‡πâ‡πÉ‡∏ô‡πÉ‡∏à‡∏Å‡πà‡∏≠‡∏ô‡∏•‡∏∞‡∏Å‡∏±‡∏ô"
        ];

        // Function to split text into parts
        function splitTextIntoParts(text, maxLength = 400) {
            const words = text.split(' ');
            const parts = [];
            let currentText = '';

            for (const word of words) {
                if ((currentText + ' ' + word).length > maxLength && currentText.length > 0) {
                    parts.push(currentText.trim());
                    currentText = word;
                } else {
                    currentText = currentText ? currentText + ' ' + word : word;
                }
            }
            
            if (currentText) {
                parts.push(currentText.trim());
            }

            return parts.length > 1 ? parts : [text];
        }

        // Function to display current letter part
        function displayLetterPart(partIndex) {
            if (partIndex >= letterParts.length) return;

            letterContent.innerHTML = '';

            // Add "To" text on the first part
            if (partIndex === 0) {
                const toElement = document.createElement('div');
                toElement.className = 'letter-part text-left mb-4';
                toElement.style.cssText = `
                    color: var(--letter-signature);
                    font-size: 0.875rem;
                    font-style: italic;
                    opacity: 0;
                    transform: translateY(20px);
                    transition: opacity 0.8s ease-out, transform 0.8s ease-out;
                `;
                toElement.textContent = '‡∏ñ‡∏∂‡∏á...‡∏ô‡πâ‡∏≠‡∏á‡∏ä‡∏°‡∏û‡∏π‡πà';
                
                letterContent.appendChild(toElement);

                // Animate "to" text in first
                setTimeout(() => {
                    toElement.style.opacity = '1';
                    toElement.style.transform = 'translateY(0)';
                }, 200);
            }

            const partElement = document.createElement('p');
            partElement.className = 'letter-part text-sm leading-relaxed';
            partElement.style.color = 'var(--letter-text)';
            partElement.textContent = letterParts[partIndex];
            
            letterContent.appendChild(partElement);

            // Add signature on the last part
            if (partIndex === letterParts.length - 1) {
                const signatureElement = document.createElement('div');
                signatureElement.className = 'letter-part text-right mt-4';
                signatureElement.style.cssText = `
                    color: var(--letter-signature);
                    font-size: 0.875rem;
                    font-style: italic;
                    opacity: 0;
                    transform: translateY(20px);
                    transition: opacity 0.8s ease-out, transform 0.8s ease-out;
                `;
                signatureElement.textContent = '‡∏à‡∏≤‡∏Å...‡∏û‡∏µ‡πà‡πÇ‡∏ä‡∏Å‡∏∏‡∏ô';
                
                letterContent.appendChild(signatureElement);

                // Animate signature in after main content
                setTimeout(() => {
                    signatureElement.style.opacity = '1';
                    signatureElement.style.transform = 'translateY(0)';
                }, 600);
            }
            
            // Trigger fade-in animation
            setTimeout(() => {
                partElement.classList.add('visible');
                // Update button text after content is shown
                updateButtonText();
            }, 100);
        }

        // Function to animate to next part
        function animateToNextPart() {
            if (currentPart >= letterParts.length - 1) return;

            const currentElement = letterContent.querySelector('.letter-part');
            if (!currentElement) return;

            // Animate current part out
            currentElement.classList.add('scroll-up');
            
            setTimeout(() => {
                currentPart++;
                displayLetterPart(currentPart);
            }, 400);
        }

        // Function to update button text based on current state
        function updateButtonText() {
            if (letterParts.length <= 1) {
                closeButton.textContent = '‡∏õ‡∏¥‡∏î‡∏à‡∏î‡∏´‡∏°‡∏≤‡∏¢';
            } else if (currentPart < letterParts.length - 1) {
                closeButton.textContent = '‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≠‡πÑ‡∏õ';
            } else {
                closeButton.textContent = '‡∏õ‡∏¥‡∏î‡∏à‡∏î‡∏´‡∏°‡∏≤‡∏¢';
            }
        }

        // Function to handle view transitions with fade-to-black
        function transitionToView(viewToShow) {
            transitionOverlay.style.opacity = '1';

            setTimeout(() => {
                allViews.forEach(view => view.classList.add('hidden'));
                viewToShow.classList.remove('hidden');

                // Reset envelope to initial state if returning to start
                if (viewToShow === startScreen) {
                    envelope.classList.remove('open');
                    letterInside.className = 'letter-inside';
                    letterInside.style.cssText = '';
                    isOpened = false;
                    isAnimating = false;
                    currentPart = 0;
                    letterContent.innerHTML = '';
                    instruction.style.opacity = '1';
                    closeButton.textContent = '‡∏õ‡∏¥‡∏î‡∏à‡∏î‡∏´‡∏°‡∏≤‡∏¢'; // Reset button text
                }

                transitionOverlay.style.opacity = '0';
            }, 800); 
        }

        // Initialize letter parts when page loads
        function initializeLetter() {
            letterParts = splitTextIntoParts(fullLetterText);
            currentPart = 0;
        }

        // --- Thought View Functions ---
        
        // Create floating particles
        function createParticle() {
            const particles = ['‚ú®', 'üí´', '‚≠ê', 'üåü', 'üíú', 'üíô', 'ü§ç'];
            const particle = document.createElement('div');
            particle.className = 'particle';
            particle.textContent = particles[Math.floor(Math.random() * particles.length)];
            particle.style.left = Math.random() * 100 + '%';
            particle.style.animationDelay = Math.random() * 8 + 's';
            particle.style.animationDuration = (8 + Math.random() * 4) + 's';
            
            particlesContainer.appendChild(particle);
            
            // Remove particle after animation
            setTimeout(() => {
                if (particle.parentNode) {
                    particle.parentNode.removeChild(particle);
                }
            }, 12000);
        }

        // Create heart particles for special moments
        function createHeartParticle(x, y) {
            const hearts = ['üíú', 'üíñ', 'üíï', 'üíó'];
            const heart = document.createElement('div');
            heart.className = 'heart-particle';
            heart.textContent = hearts[Math.floor(Math.random() * hearts.length)];
            heart.style.left = (x || Math.random() * 100) + '%';
            heart.style.top = (y || 80) + '%';
            
            heartContainer.appendChild(heart);
            
            // Remove heart after animation
            setTimeout(() => {
                if (heart.parentNode) {
                    heart.parentNode.removeChild(heart);
                }
            }, 3000);
        }

        // Typewriter effect for thoughts
        function typewriterEffect(text, element, callback) {
            element.textContent = '';
            element.classList.add('typewriter');
            
            let i = 0;
            function type() {
                if (i < text.length) {
                    element.textContent += text.charAt(i);
                    i++;
                    typewriterTimeout = setTimeout(type, 60 + Math.random() * 40);
                } else {
                    element.classList.add('no-caret');
                    if (callback) callback();
                }
            }
            type();
        }

        // Display current thought
        function displayThought(index) {
            if (index >= thoughtMessages.length) {
                // All thoughts displayed, show continue button
                continueButton.style.opacity = '1';
                continueButton.style.transform = 'scale(1)';
                continueButton.style.pointerEvents = 'auto';
                return;
            }

            const message = thoughtMessages[index];
            
            // Clear previous animations
            if (typewriterTimeout) {
                clearTimeout(typewriterTimeout);
            }
            
            // Add fade-in animation (without zoom)
            thoughtText.classList.add('fade-in-thought');
            
            // Special effects for certain thoughts
            if (index === 1 || index === 3) {
                // Add breathing effect for emotional thoughts
                setTimeout(() => {
                    thoughtText.classList.add('breathing');
                }, 1000);
                
                // Create heart particles
                setTimeout(() => {
                    for (let i = 0; i < 3; i++) {
                        setTimeout(() => {
                            createHeartParticle(30 + Math.random() * 40, 60 + Math.random() * 20);
                        }, i * 500);
                    }
                }, 1500);
            }
            
            if (index === thoughtMessages.length - 1) {
                // Last thought gets soft glow and show button
                setTimeout(() => {
                    thoughtText.classList.add('soft-glow');
                }, 1000);
            }
            
            // Start typewriter effect
            setTimeout(() => {
                typewriterEffect(message, thoughtText, () => {
                    // Auto advance after 1.4 seconds for all messages except the last one
                    if (index < thoughtMessages.length - 1) {
                        setTimeout(() => {
                            autoNextThought();
                        }, 1400);
                    } else {
                        // Show continue button only after the last message
                        setTimeout(() => {
                            continueButton.style.opacity = '1';
                            continueButton.style.transform = 'scale(1)';
                            continueButton.style.pointerEvents = 'auto';
                        }, 1000);
                    }
                });
            }, 500);
        }

        // Auto advance to next thought (without user interaction)
        function autoNextThought() {
            if (currentThought < thoughtMessages.length - 1) {
                // Clear classes for transition
                thoughtText.classList.remove('fade-in-thought', 'breathing', 'soft-glow', 'typewriter', 'no-caret');
                thoughtText.classList.add('fade-out-thought');
                
                setTimeout(() => {
                    thoughtText.classList.remove('fade-out-thought');
                    currentThought++;
                    displayThought(currentThought);
                }, 800);
            }
        }

        // Move to next thought
        function nextThought() {
            if (currentThought < thoughtMessages.length - 1) {
                // Clear classes for transition
                thoughtText.classList.remove('fade-in-thought', 'breathing', 'soft-glow', 'typewriter', 'no-caret');
                thoughtText.classList.add('fade-out-thought');
                
                setTimeout(() => {
                    thoughtText.classList.remove('fade-out-thought');
                    currentThought++;
                    displayThought(currentThought);
                }, 800);
            } else if (currentThought >= thoughtMessages.length - 1) {
                // Return to start screen
                returnToStart();
            }
        }

        // Initialize thought view
        function initializeThoughts() {
            currentThought = 0;
            thoughtText.classList.remove('fade-in-thought', 'fade-out-thought', 'breathing', 'soft-glow', 'typewriter', 'no-caret');
            thoughtText.textContent = '';
            
            // Hide continue button initially
            continueButton.style.opacity = '0';
            continueButton.style.transform = 'scale(0.8)';
            continueButton.style.pointerEvents = 'none';
            
            // Start particles animation
            const particleInterval = setInterval(() => {
                if (document.getElementById('thought-view').classList.contains('hidden')) {
                    clearInterval(particleInterval);
                    return;
                }
                createParticle();
            }, 1500);
            
            // Display first thought
            setTimeout(() => {
                displayThought(0);
            }, 1000);
        }

        // Return to start screen from thoughts
        function returnToStart() {
            isThinking = false;
            if (typewriterTimeout) {
                clearTimeout(typewriterTimeout);
            }
            
            transitionToView(startScreen);
        }

        // --- Event Listeners ---

        startButton.addEventListener('click', () => {
            transitionToView(envelopeView);
        });
        
        // Modified: New letter sliding animation
        envelope.addEventListener('click', () => {
            if (isOpened || isAnimating) return;
            isAnimating = true;

            // Step 1: Open envelope flap
            envelope.classList.add('open');
            instruction.style.opacity = '0';

            // Step 2: Wait for flap animation to complete, then change z-index and slide letter out
            setTimeout(() => {
                // Change z-index right before letter slides out
                document.querySelector('.top-flap').style.zIndex = '1';
                
                // Small delay to ensure z-index change takes effect
                setTimeout(() => {
                    letterInside.classList.add('letter-sliding-out');
                    
                    setTimeout(() => {
                        // Step 3: Expand letter to center
                        letterInside.classList.remove('letter-sliding-out');
                        letterInside.classList.add('letter-expanding');
                        
                        setTimeout(() => {
                            isOpened = true;
                            isAnimating = false;
                            // Initialize and display first part of letter
                            displayLetterPart(0);
                            // Update button text
                            updateButtonText();
                        }, 1000);
                    }, 1200);
                }, 100);
            }, 800);
        });

        // Modified: Dynamic button functionality (next page or close)
        closeButton.addEventListener('click', () => {
            if (!isOpened || isAnimating) return;

            // Check if there are more parts to show
            if (letterParts.length > 1 && currentPart < letterParts.length - 1) {
                // Show next part
                animateToNextPart();
                updateButtonText();
            } else {
                // Close letter and go to thought view
                isAnimating = true;

                // Step 1: Shrink letter back to envelope position
                letterInside.classList.remove('letter-expanding');
                letterInside.classList.add('letter-shrinking');

                setTimeout(() => {
                    // Step 2: Slide letter back into envelope
                    letterInside.classList.remove('letter-shrinking');
                    letterInside.classList.add('letter-sliding-in');

                    setTimeout(() => {
                        // Step 3: Close envelope flap and reset z-index
                        envelope.classList.remove('open');
                        document.querySelector('.top-flap').style.zIndex = '5';
                        
                        setTimeout(() => {
                            // Step 4: Transition to thought view instead of start screen
                            transitionToView(thoughtView);
                            
                            // Initialize thoughts after transition
                            setTimeout(() => {
                                initializeThoughts();
                                isThinking = true;
                            }, 800);

                        }, 800);
                    }, 1200);
                }, 1000);
            }
        });

        // --- Thought View Event Listeners ---

        // Continue button to return to start (only button that works now)
        continueButton.addEventListener('click', () => {
            returnToStart();
        });

        // Keep escape key to return to start
        document.addEventListener('keydown', (e) => {
            if (!isThinking) return;
            
            if (e.code === 'Escape') {
                e.preventDefault();
                returnToStart();
            }
        });

        // Initialize when page loads
        window.addEventListener('load', initializeLetter);
    </script>

</body>
</html>
