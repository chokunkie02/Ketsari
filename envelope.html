<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡πÄ‡∏ó‡∏°‡πÄ‡∏û‡∏•‡∏ï‡∏ã‡∏≠‡∏á‡∏à‡∏î‡∏´‡∏°‡∏≤‡∏¢</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            /* --- Color Scheme --- */
            --bg-color: #F8F6FF;
            --primary-text: #8B5DFF;
            --darker-text: #6A3ED4;
            --primary-accent: #B794F6;
            --envelope-light: #E6D8FF;
            --envelope-dark: #9B6BFF;
            --letter-text: #2D3748;
            --letter-title: #1A202C;
            --letter-signature: #553C9A;
        }
        
        body {
            font-family: 'Kanit', sans-serif;
            overflow: hidden;
            background-color: var(--bg-color);
        }
        
        /* --- Transitions --- */
        #transition-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background-color: #000;
            opacity: 0;
            pointer-events: none;
            z-index: 9999;
            transition: opacity 0.8s ease-in-out;
        }
        .view {
            transition: opacity 0.5s ease-in-out, transform 0.5s ease-in-out;
            position: absolute;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .view.hidden {
            opacity: 0;
            pointer-events: none;
        }

        /* --- Start Screen --- */
        #start-button {
            transition: transform 0.2s, box-shadow 0.2s;
        }
        #start-button:hover {
            transform: translateY(-4px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }

        /* --- Envelope Design --- */
        .envelope-wrapper {
            perspective: 1000px;
            position: relative;
        }
        .envelope {
            position: relative;
            width: 300px;
            height: 200px;
            cursor: pointer;
            transition: transform 0.5s;
            filter: drop-shadow(0 10px 8px rgba(0,0,0,0.1));
        }
        .envelope:hover {
            transform: translateY(-10px) scale(1.03);
        }
        .envelope.open .top-flap {
            transform: rotateX(180deg);
        }
       
        /* Envelope Parts */
        .envelope .flap {
            position: absolute;
        }
        .envelope .left-flap {
            top: 0; left: 0; width: 155px; height: 200px;
            background-image: linear-gradient(to bottom right, var(--primary-accent), var(--primary-text));
            clip-path: polygon(100% 0, 0 50%, 100% 100%);
            z-index: 2;
        }
        .envelope .right-flap {
            top: 0; right: 0; width: 155px; height: 200px;
            background-image: linear-gradient(to bottom left, var(--primary-accent), var(--primary-text));
            clip-path: polygon(0 0, 100% 50%, 0 100%);
            z-index: 2;
        }
        .envelope .bottom-flap {
            bottom: 0; left: 0; width: 300px; height: 105px;
            background-image: linear-gradient(to top, var(--primary-accent), var(--primary-text));
            clip-path: polygon(0 0, 100% 0, 50% 100%);
            z-index: 2;
        }
        .envelope .top-flap {
            top: 0; left: 0; width: 100%; height: 105px;
            background-image: linear-gradient(to bottom, var(--primary-text), var(--darker-text));
            clip-path: polygon(0 0, 100% 0, 50% 100%);
            transform-origin: top;
            transition: transform 0.8s ease-in-out;
            z-index: 5;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        .envelope .front-panel {
            top: 0; left: 0; width: 100%; height: 100%;
            background-color: var(--envelope-light);
            border-radius: 8px;
            z-index: 4;
            box-shadow: inset 0 0 15px rgba(0,0,0,0.1);
        }
        .envelope .seal {
            position: absolute;
            top: 85px;
            left: 50%;
            transform: translateX(-50%);
            width: 30px;
            height: 30px;
            background: var(--envelope-light);
            border: 1px solid var(--darker-text);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            z-index: 6;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
            transition: opacity 0.5s;
        }
        .envelope.open .seal {
            opacity: 0;
        }

        /* --- Letter Inside Envelope --- */
        .letter-inside {
            position: absolute;
            width: 260px;
            height: 180px;
            top: 15px;
            left: 20px;
            background: linear-gradient(135deg, #ffffff 0%, #faf9ff 100%);
            border: 1px solid var(--envelope-light);
            border-radius: 6px;
            box-shadow: 0 2px 8px rgba(139, 93, 255, 0.15);
            z-index: 3;
            transform: translateY(0) scale(0.85);
            transition: none;
            padding: 15px;
            box-sizing: border-box;
            opacity: 0;
        }

        /* Letter animations */
        @keyframes letter-slide-out {
            0% { 
                transform: translateY(0) scale(0.85);
                opacity: 0;
            }
            30% { 
                opacity: 0.7;
            }
            70% { 
                transform: translateY(-150px) scale(0.85);
                opacity: 0.9;
            }
            100% { 
                transform: translateY(-200px) scale(0.85);
                opacity: 1;
            }
        }

        @keyframes letter-expand-center {
            0% { 
                transform: translateY(-200px) scale(0.85);
                opacity: 1;
            }
            100% { 
                transform: translate(-50%, -40%) scale(1.2);
                left: 50%;
                top: 60%;
                width: 400px;
                height: 500px;
                z-index: 10;
                opacity: 1;
            }
        }

        @keyframes letter-shrink-back {
            0% { 
                transform: translate(-50%, -40%) scale(1.2);
                left: 50%;
                top: 60%;
                width: 400px;
                height: 500px;
                z-index: 10;
                opacity: 1;
            }
            100% { 
                transform: translateY(-200px) scale(0.85);
                left: 20px;
                top: 15px;
                width: 260px;
                height: 180px;
                z-index: 4;
                opacity: 1;
            }
        }

        @keyframes letter-slide-in {
            0% { 
                transform: translateY(-200px) scale(0.85);
                opacity: 1;
            }
            30% { 
                transform: translateY(-150px) scale(0.85);
                opacity: 0.9;
            }
            70% { 
                opacity: 0.7;
            }
            100% { 
                transform: translateY(0) scale(0.85);
                opacity: 0;
            }
        }

        .letter-sliding-out {
            animation: letter-slide-out 1.2s cubic-bezier(0.4, 0, 0.2, 1) forwards;
        }
        .letter-expanding {
            animation: letter-expand-center 1s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards;
        }
        .letter-shrinking {
            animation: letter-shrink-back 1s cubic-bezier(0.55, 0.06, 0.68, 0.19) forwards;
        }
        .letter-sliding-in {
            animation: letter-slide-in 1.2s cubic-bezier(0.8, 0, 0.6, 1) forwards;
        }

        /* --- Letter Content Animation --- */
        .letter-part {
            opacity: 0;
            transform: translateY(20px);
            transition: opacity 0.8s ease-out, transform 0.8s ease-out;
        }
        .letter-part.visible {
            opacity: 1;
            transform: translateY(0);
        }
        .letter-part.scroll-up {
            animation: scroll-up 0.8s ease-out forwards;
        }
        @keyframes scroll-up {
            0% {
                opacity: 1;
                transform: translateY(0);
            }
            100% {
                opacity: 0;
                transform: translateY(-30px);
            }
        }

        /* --- Pop-up --- */
        #popup-message {
            transition: opacity 0.5s ease-in-out, transform 0.5s ease-in-out;
            text-shadow: 2px 2px 8px rgba(0,0,0,0.5);
        }
        /* === ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡πà‡∏ß‡∏ô‡∏ô‡∏µ‡πâ‡∏ï‡πà‡∏≠‡∏ó‡πâ‡∏≤‡∏¢‡πÉ‡∏ô <style> === */
        
        @media (max-width: 600px) { 
            
            /* * 1. ‡∏õ‡∏£‡∏±‡∏ö Keyframe ‡∏Ç‡∏≠‡∏á‡∏à‡∏î‡∏´‡∏°‡∏≤‡∏¢‡∏ï‡∏≠‡∏ô‡∏Ç‡∏¢‡∏≤‡∏¢
             * ‡πÉ‡∏´‡πâ‡πÄ‡∏ï‡πá‡∏°‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠
             */
            @keyframes letter-expand-center {
                0% { 
                    transform: translateY(-200px) scale(0.85);
                    opacity: 1;
                }
                100% { 
                    /* --- ‡∏ô‡∏µ‡πà‡∏Ñ‡∏∑‡∏≠‡∏à‡∏∏‡∏î‡∏ó‡∏µ‡πà‡πÅ‡∏Å‡πâ --- */
                    transform: translate(-50%, -50%) scale(1.0); /* ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô scale ‡πÄ‡∏õ‡πá‡∏ô 1 */
                    left: 50%;
                    top: 50%;     /* ‡∏à‡∏±‡∏î‡∏Å‡∏•‡∏≤‡∏á‡∏à‡∏≠ */
                    width: 95vw;  /* ‡∏Å‡∏ß‡πâ‡∏≤‡∏á 95% ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏ß‡πâ‡∏≤‡∏á‡∏à‡∏≠ */
                    height: 80vh; /* ‡∏™‡∏π‡∏á 80% ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏π‡∏á‡∏à‡∏≠ */
                    z-index: 10;
                    opacity: 1;
                }
            }

            /* * 2. ‡∏õ‡∏£‡∏±‡∏ö Keyframe ‡∏ï‡∏≠‡∏ô‡∏´‡∏î‡∏Å‡∏•‡∏±‡∏ö
             * ‡πÉ‡∏´‡πâ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏à‡∏≤‡∏Å‡∏Ç‡∏ô‡∏≤‡∏î‡∏ó‡∏µ‡πà‡πÄ‡∏ï‡πá‡∏°‡∏à‡∏≠ (‡∏ï‡∏≤‡∏°‡∏ó‡∏µ‡πà‡πÅ‡∏Å‡πâ‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô)
             */
            @keyframes letter-shrink-back {
                0% { 
                    /* --- ‡∏ô‡∏µ‡πà‡∏Ñ‡∏∑‡∏≠‡∏à‡∏∏‡∏î‡∏ó‡∏µ‡πà‡πÅ‡∏Å‡πâ --- */
                    transform: translate(-50%, -50%) scale(1.0);
                    left: 50%;
                    top: 50%;
                    width: 95vw;
                    height: 80vh;
                    z-index: 10;
                    opacity: 1;
                }
                100% { 
                    /* ‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏ó‡∏µ‡πà‡∏Ñ‡πà‡∏≤‡πÄ‡∏î‡∏¥‡∏° (‡∏ã‡∏∂‡πà‡∏á‡∏ã‡πà‡∏≠‡∏ô‡πÉ‡∏ô‡∏ã‡∏≠‡∏á) */
                    transform: translateY(-200px) scale(0.85);
                    left: 20px;
                    top: 15px;
                    width: 260px;
                    height: 180px;
                    z-index: 4;
                    opacity: 1;
                }
            }
        }
        /* === ‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏û‡∏¥‡πà‡∏° === */

    </style>
</head>
<body style="background-color: #F8F6FF;">

    <div id="transition-overlay"></div>

    <div id="popup-message" class="fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 text-white text-2xl font-semibold opacity-0 pointer-events-none z-50 transform scale-90" style="color: var(--primary-text); text-shadow: 2px 2px 8px rgba(139, 93, 255, 0.5);">
        <span>‡∏õ‡∏¥‡∏î‡∏à‡∏î‡∏´‡∏°‡∏≤‡∏¢‡πÅ‡∏•‡πâ‡∏ß</span>
    </div>

    <div id="start-screen" class="view text-center">
        <button id="start-button" class="font-bold py-3 px-8 rounded-full text-lg shadow-lg text-white transition-transform transition-shadow duration-200" style="background-color: var(--primary-text);" onmouseover="this.style.backgroundColor='var(--darker-text)'" onmouseout="this.style.backgroundColor='var(--primary-text)'">
            ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏•‡∏¢!
        </button>
    </div>

    <div id="envelope-view" class="view hidden text-center flex-col items-center justify-center">
        <div class="envelope-wrapper">
            <div id="envelope" class="envelope">
                <div class="flap left-flap"></div>
                <div class="flap right-flap"></div>
                <div class="flap bottom-flap"></div>
                <div class="flap front-panel"></div>
                
                <div id="letter-inside" class="letter-inside">
                    <div class="text-center">
                        <h1 class="text-2xl font-bold mb-3 tracking-tight" style="color: var(--letter-title);">
                            [‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á]
                        </h1>
                    </div>
                    <div class="text-left mt-3" id="letter-content">
                        </div>
                    <div class="text-center mt-auto pt-3 absolute bottom-4 left-0 right-0">
                        <button id="close-button" class="mt-4 text-white font-bold py-2 px-4 rounded-full transition duration-300 shadow-md" style="background-color: var(--primary-text);" onmouseover="this.style.backgroundColor='var(--darker-text)'" onmouseout="this.style.backgroundColor='var(--primary-text)'">
                            ‡∏õ‡∏¥‡∏î‡∏à‡∏î‡∏´‡∏°‡∏≤‡∏¢
                        </button>
                    </div>
                </div>
                
                <div class="flap top-flap"></div>
                <div class="seal">üíú</div>
            </div>
        </div>
        <p id="instruction" class="mt-12 text-lg font-semibold transition-opacity duration-500" style="color: var(--primary-text);">
            ‡∏ã‡∏≠‡∏á‡∏à‡∏î‡∏´‡∏°‡∏≤‡∏¢<br> <span class="text-sm font-normal">‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏¥‡∏î</span>
        </p>
    </div>

    <script>
        // DOM Elements
        const transitionOverlay = document.getElementById('transition-overlay');
        const startScreen = document.getElementById('start-screen');
        const startButton = document.getElementById('start-button');
        const envelopeView = document.getElementById('envelope-view');
        const envelope = document.getElementById('envelope');
        const instruction = document.getElementById('instruction');
        const letterInside = document.getElementById('letter-inside');
        const closeButton = document.getElementById('close-button');
        const popupMessage = document.getElementById('popup-message');
        const letterContent = document.getElementById('letter-content');
        
        const allViews = document.querySelectorAll('.view');

        let isOpened = false;
        let isAnimating = false;
        let currentPart = 0;
        let letterParts = [];

        // Letter content - split into parts for long text
        const fullLetterText = `[‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà...]‡∏î‡∏Å‡πÄ
‡∏î‡∏Å‡πÄ‡∏î‡∏Å‡πÄ
‡∏Å‡∏î‡πÄ‡∏Å‡∏î‡πÄ‡πÄ‡πÄ‡πÄ‡πÄ‡πÄ
‡∏Å‡∏î‡πÄ‡∏î‡πÄ‡∏î‡πÄ‡∏î‡πÄ‡∏î‡πÄ‡∏î‡πÄ‡∏î‡πÄ‡∏î‡πÄ‡∏î‡πÄ‡∏î‡πÄ‡∏î‡πÄ‡∏î‡πÄ‡∏î‡πÄ‡∏î‡πÄ‡∏î‡πÄ‡∏î‡πÄ
‡∏Å‡∏î‡πÄ‡∏î‡πÄ‡∏î‡πÄ‡∏î‡πÄ‡∏î‡πÄ‡∏î‡πÄ‡∏î‡πÄ‡∏î‡πÄ‡∏î‡πÄ‡∏î‡πÄ‡∏î‡πÄ‡∏î‡πÄ‡∏î‡πÄ‡∏î‡πÄ‡∏î‡πÄ‡∏î‡πÄ‡∏Å‡∏î‡πÄ‡∏Å‡∏î
‡∏î‡∏Å‡πÄ‡∏î‡∏Å‡πÄ‡∏î‡∏Å‡πÄ‡∏î‡∏Å‡πÄ‡∏î‡∏Å‡πÄ‡∏Å‡∏î
‡∏î‡∏Å‡πÄ‡∏Å‡∏î‡πÄ‡∏î‡∏Å‡πÄ‡∏î‡∏Å‡πÄ‡∏Å‡∏î‡πÄ‡∏Å‡∏î‡πÄ‡∏î‡∏Å
‡∏î‡∏Å‡πÄ‡∏î‡∏Å‡πÄ‡∏Å‡πÄ‡∏Å‡∏î‡∏î‡∏Å
‡∏´‡∏Å‡∏î‡∏Å‡∏´‡∏î‡∏´‡∏Å‡∏î‡∏´
‡∏´‡∏Å‡∏î‡∏´‡∏Å‡∏î‡∏´‡∏î‡∏´‡∏Å‡∏î
‡∏´‡∏Å‡∏î‡∏´‡∏Å‡∏î‡∏Å‡∏´‡∏î‡∏Å‡∏´‡∏î‡∏´
‡∏´‡∏Å‡∏î‡∏´‡∏Å‡∏î‡∏Å‡∏´‡∏î‡∏Å‡∏´‡∏î‡∏´‡∏´‡∏î
‡∏´‡∏Å‡∏î‡∏´‡∏Å‡∏î‡∏´‡∏Å‡∏î‡∏´‡∏Å‡∏î‡∏Å‡∏´‡∏î
‡∏´‡∏Å‡∏î‡∏´‡∏Å‡∏î‡∏´‡∏Å‡∏î‡∏´‡∏Å‡∏î‡∏Å‡∏´‡∏î‡∏Å‡∏´
‡∏Å‡∏´‡∏î‡∏´‡∏Å‡∏î‡∏Å‡∏´‡∏î‡∏´‡∏Å‡∏î‡∏Å‡∏´‡∏î
‡∏Å‡∏´‡∏î‡∏´‡∏Å‡∏î‡∏Å‡∏´‡∏î‡∏´‡∏Å‡∏î‡∏Å‡∏´‡∏î‡∏´
‡πÅ‡∏•‡∏∞‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏ß‡πÜ ‡∏ï‡πà‡∏≠‡πÑ‡∏õ‡∏≠‡∏µ‡∏Å‡∏°‡∏≤‡∏Å‡∏°‡∏≤‡∏¢ ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏ö‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏≠‡∏á‡∏ó‡πà‡∏≠‡∏ô
‡πÉ‡∏´‡πâ‡∏î‡∏π‡∏ß‡πà‡∏≤‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏™dzsfsdfsdfsfsdf
sdfsdfsd
sdfsfsfsd
sdfsdfsdfsdf
dsfsdfsdfsdf
fsdfsdfsd‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Å‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏ß‡πÑ‡∏î‡πâ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÑ‡∏£
‡πÇ‡∏î‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ç‡∏∂‡πâ‡∏ô‡πÑ‡∏õ‡πÅ‡∏ö‡∏ö‡∏£‡∏≤‡∏ö‡∏£‡∏∑‡πà‡∏ô
‡πÅ‡∏•‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏≠‡∏á‡∏ï‡πà‡∏≠‡∏à‡∏≤‡∏Å‡∏™‡πà‡∏ß‡∏ô‡πÅ‡∏£‡∏Å‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏î‡∏ï‡∏≠‡∏ô`;


        // Function to split text into parts
        function splitTextIntoParts(text, maxLength = 400) {
            const words = text.split(' ');
            const parts = [];
            let currentText = '';

            for (const word of words) {
                if ((currentText + ' ' + word).length > maxLength && currentText.length > 0) {
                    parts.push(currentText.trim());
                    currentText = word;
                } else {
                    currentText = currentText ? currentText + ' ' + word : word;
                }
            }
            
            if (currentText) {
                parts.push(currentText.trim());
            }

            return parts.length > 1 ? parts : [text];
        }

        // Function to display current letter part
        function displayLetterPart(partIndex) {
            if (partIndex >= letterParts.length) return;

            letterContent.innerHTML = '';

            // Add "To" text on the first part
            if (partIndex === 0) {
                const toElement = document.createElement('div');
                toElement.className = 'letter-part text-left mb-4';
                toElement.style.cssText = `
                    color: var(--letter-signature);
                    font-size: 0.875rem;
                    font-style: italic;
                    opacity: 0;
                    transform: translateY(20px);
                    transition: opacity 0.8s ease-out, transform 0.8s ease-out;
                `;
                toElement.textContent = '‡∏ñ‡∏∂‡∏á...‡∏ô‡πâ‡∏≠‡∏á‡∏ä‡∏°‡∏û‡∏π‡πà';
                
                letterContent.appendChild(toElement);

                // Animate "to" text in first
                setTimeout(() => {
                    toElement.style.opacity = '1';
                    toElement.style.transform = 'translateY(0)';
                }, 200);
            }

            const partElement = document.createElement('p');
            partElement.className = 'letter-part text-sm leading-relaxed';
            partElement.style.color = 'var(--letter-text)';
            partElement.textContent = letterParts[partIndex];
            
            letterContent.appendChild(partElement);

            // Add signature on the last part
            if (partIndex === letterParts.length - 1) {
                const signatureElement = document.createElement('div');
                signatureElement.className = 'letter-part text-right mt-4';
                signatureElement.style.cssText = `
                    color: var(--letter-signature);
                    font-size: 0.875rem;
                    font-style: italic;
                    opacity: 0;
                    transform: translateY(20px);
                    transition: opacity 0.8s ease-out, transform 0.8s ease-out;
                `;
                signatureElement.textContent = '‡∏à‡∏≤‡∏Å...‡∏û‡∏µ‡πà‡πÇ‡∏ä‡∏Å‡∏∏‡∏ô';
                
                letterContent.appendChild(signatureElement);

                // Animate signature in after main content
                setTimeout(() => {
                    signatureElement.style.opacity = '1';
                    signatureElement.style.transform = 'translateY(0)';
                }, 600);
            }
            
            // Trigger fade-in animation
            setTimeout(() => {
                partElement.classList.add('visible');
                // Update button text after content is shown
                updateButtonText();
            }, 100);
        }

        // Function to animate to next part
        function animateToNextPart() {
            if (currentPart >= letterParts.length - 1) return;

            const currentElement = letterContent.querySelector('.letter-part');
            if (!currentElement) return;

            // Animate current part out
            currentElement.classList.add('scroll-up');
            
            setTimeout(() => {
                currentPart++;
                displayLetterPart(currentPart);
            }, 400);
        }

        // Function to update button text based on current state
        function updateButtonText() {
            if (letterParts.length <= 1) {
                closeButton.textContent = '‡∏õ‡∏¥‡∏î‡∏à‡∏î‡∏´‡∏°‡∏≤‡∏¢';
            } else if (currentPart < letterParts.length - 1) {
                closeButton.textContent = '‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≠‡πÑ‡∏õ';
            } else {
                closeButton.textContent = '‡∏õ‡∏¥‡∏î‡∏à‡∏î‡∏´‡∏°‡∏≤‡∏¢';
            }
        }

        /**
         * Function to handle view transitions
         * @param {HTMLElement} viewToShow - The view element to show
         * @param {boolean} [isRedirect=false] - Whether this transition is a page redirect
         * @param {string} [url=''] - The URL to redirect to
         */
        function transitionToView(viewToShow, isRedirect = false, url = '') {
            transitionOverlay.style.opacity = '1';

            setTimeout(() => {
                if (isRedirect) {
                    // If it's a redirect, just change the window location
                    window.location.href = url;
                } else {
                    // If it's an internal view switch
                    allViews.forEach(view => view.classList.add('hidden'));
                    viewToShow.classList.remove('hidden');

                    // Reset envelope to initial state if returning to start
                    if (viewToShow === startScreen) {
                        envelope.classList.remove('open');
                        letterInside.className = 'letter-inside';
                        letterInside.style.cssText = '';
                        isOpened = false;
                        isAnimating = false;
                        currentPart = 0;
                        letterContent.innerHTML = '';
                        instruction.style.opacity = '1';
                        closeButton.textContent = '‡∏õ‡∏¥‡∏î‡∏à‡∏î‡∏´‡∏°‡∏≤‡∏¢'; // Reset button text
                    }
                    
                    transitionOverlay.style.opacity = '0';
                }
            }, 800); 
        }

        // Initialize letter parts when page loads
        function initializeLetter() {
            letterParts = splitTextIntoParts(fullLetterText);
            currentPart = 0;
        }

        // --- Event Listeners ---

        startButton.addEventListener('click', () => {
            transitionToView(envelopeView);
        });
        
        envelope.addEventListener('click', () => {
            if (isOpened || isAnimating) return;
            isAnimating = true;

            envelope.classList.add('open');
            instruction.style.opacity = '0';

            setTimeout(() => {
                document.querySelector('.top-flap').style.zIndex = '1';
                
                setTimeout(() => {
                    letterInside.classList.add('letter-sliding-out');
                    
                    setTimeout(() => {
                        letterInside.classList.remove('letter-sliding-out');
                        letterInside.classList.add('letter-expanding');
                        
                        setTimeout(() => {
                            isOpened = true;
                            isAnimating = false;
                            displayLetterPart(0);
                            updateButtonText();
                        }, 1000);
                    }, 1200);
                }, 100);
            }, 800);
        });

        closeButton.addEventListener('click', () => {
            if (!isOpened || isAnimating) return;

            if (letterParts.length > 1 && currentPart < letterParts.length - 1) {
                animateToNextPart();
                updateButtonText();
            } else {
                // ** MODIFICATION HERE **
                // Close letter and go to thought view
                isAnimating = true;

                letterInside.classList.remove('letter-expanding');
                letterInside.classList.add('letter-shrinking');

                setTimeout(() => {
                    letterInside.classList.remove('letter-shrinking');
                    letterInside.classList.add('letter-sliding-in');

                    setTimeout(() => {
                        envelope.classList.remove('open');
                        document.querySelector('.top-flap').style.zIndex = '5';
                        
                        setTimeout(() => {
                            // ** MODIFICATION HERE **
                            // Transition to the new 'thought.html' page
                            transitionToView(null, true, 'thought.html');

                        }, 800);
                    }, 1200);
                }, 1000);
            }
        });

        // Initialize when page loads
        window.addEventListener('load', initializeLetter);
    </script>

</body>
</html>