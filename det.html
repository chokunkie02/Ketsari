<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #e8f4f8 0%, #f5f1eb 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.15);
            padding: 30px;
            margin-bottom: 20px;
            border: 1px solid rgba(102, 126, 234, 0.1);
        }

        h1 {
            text-align: center;
            color: #5a7a8c;
            margin-bottom: 30px;
            font-size: 2.5rem;
            text-shadow: 1px 1px 3px rgba(90, 122, 140, 0.2);
        }

        .main-menu {
            text-align: center;
            margin-bottom: 30px;
        }

        .function-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .function-btn {
            background: linear-gradient(135deg, #7fb3d3 0%, #c4a484 100%);
            color: white;
            border: none;
            border-radius: 15px;
            padding: 25px 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 5px 20px rgba(0,0,0,0.2);
            text-align: left;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .function-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(127, 179, 211, 0.3);
        }

        .btn-icon {
            font-size: 2rem;
            margin-bottom: 5px;
        }

        .btn-title {
            font-size: 1.2rem;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .btn-desc {
            font-size: 0.9rem;
            opacity: 0.9;
            line-height: 1.4;
        }

        .function-section {
            margin-top: 20px;
        }

        .section-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 25px;
        }

        .back-btn {
            background: #e8f4f8;
            border: 1px solid #7fb3d3;
            border-radius: 8px;
            padding: 10px 15px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s ease;
        }

        .back-btn:hover {
            background: #d6e9f0;
            transform: translateX(-2px);
        }

        .size-buttons {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .size-btn {
            background: linear-gradient(45deg, #7fb3d3, #c4a484);
            color: white;
            border: none;
            padding: 15px 25px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 18px;
            font-weight: bold;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(127, 179, 211, 0.3);
        }

        .size-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(127, 179, 211, 0.4);
        }

        .size-btn.active {
            background: linear-gradient(45deg, #a8d0c7, #8db4a0);
            transform: scale(1.05);
        }

        .matrix-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 30px 0;
        }

        .matrix-table {
            border-collapse: separate;
            border-spacing: 10px;
            margin: 20px 0;
            background: #f8fcfd;
            padding: 20px;
            border-radius: 15px;
            box-shadow: inset 0 2px 10px rgba(127, 179, 211, 0.1);
        }

        .matrix-input {
            width: 60px;
            height: 60px;
            text-align: center;
            border: 2px solid #d6e9f0;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s ease;
            background: white;
        }

        .matrix-input:focus {
            outline: none;
            border-color: #7fb3d3;
            box-shadow: 0 0 0 3px rgba(127, 179, 211, 0.2);
            transform: scale(1.05);
        }

        .current-input {
            border: 3px solid #c4a484 !important;
            box-shadow: 0 0 10px rgba(196, 164, 132, 0.5) !important;
        }

        .calculate-btn {
            background: linear-gradient(45deg, #7fb3d3, #c4a484);
            color: white;
            border: none;
            padding: 15px 40px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 20px;
            font-weight: bold;
            margin: 20px 0;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(127, 179, 211, 0.3);
        }

        .calculate-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(127, 179, 211, 0.4);
        }

        .button-group {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin: 20px 0;
            flex-wrap: wrap;
        }

        .clear-btn {
            background: linear-gradient(45deg, #c4a484, #a89371);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 18px;
            font-weight: bold;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(196, 164, 132, 0.3);
        }

        .clear-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(196, 164, 132, 0.4);
        }

        .result {
            text-align: center;
            margin-top: 20px;
            padding: 20px;
            background: linear-gradient(45deg, #a8d0c7, #8db4a0);
            color: white;
            border-radius: 10px;
            font-size: 24px;
            font-weight: bold;
            box-shadow: 0 4px 15px rgba(168, 208, 199, 0.3);
            display: none;
        }

        .error {
            background: linear-gradient(45deg, #e8a4a4, #d18888);
        }

        .random-result, .cramer-result, .tree-result {
            margin-top: 30px;
            padding: 20px;
            background: #f8fcfd;
            border-radius: 10px;
            border: 2px solid #d6e9f0;
        }

        .problem-display {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin: 15px 0;
            box-shadow: 0 2px 10px rgba(127, 179, 211, 0.1);
        }

        .matrix-display {
            font-family: 'Courier New', monospace;
            font-size: 16px;
            line-height: 1.6;
            text-align: center;
            margin: 15px 0;
        }

        .answer-box {
            background: linear-gradient(45deg, #48bb78, #38a169);
            color: white;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            font-size: 1.2rem;
            font-weight: bold;
            margin-top: 15px;
        }

        .solution-steps {
            margin-top: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            border-left: 4px solid #667eea;
        }

        .solution-steps h3 {
            color: #4a5568;
            margin-bottom: 15px;
        }

        .step {
            margin: 15px 0;
            padding: 10px;
            background: white;
            border-radius: 5px;
            border-left: 3px solid #e2e8f0;
        }

        .error-checker {
            margin-top: 30px;
            padding: 20px;
            background: #fff5f5;
            border-radius: 10px;
            border-left: 4px solid #fc8181;
        }

        .error-checker h3 {
            color: #c53030;
            margin-bottom: 15px;
        }

        .step-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin: 15px 0;
        }

        .step-btn {
            background: #e2e8f0;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s ease;
        }

        .step-btn:hover {
            background: #cbd5e0;
        }

        .step-btn.active {
            background: #667eea;
            color: white;
        }

        .equation-container, .adjacency-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 30px 0;
        }

        .equation-input {
            width: 50px;
            height: 40px;
            text-align: center;
            border: 2px solid #e2e8f0;
            border-radius: 5px;
            font-size: 16px;
            margin: 2px;
        }

        .equation-input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 2px rgba(102, 126, 234, 0.1);
        }

        .equation-row {
            display: flex;
            align-items: center;
            margin: 5px 0;
            gap: 5px;
        }

        .fraction {
            display: inline-flex;
            flex-direction: column;
            align-items: center;
            font-family: serif;
        }

        .fraction .numerator {
            border-bottom: 1px solid black;
            padding-bottom: 2px;
        }

        .fraction .denominator {
            padding-top: 2px;
        }

        @media (max-width: 768px) {
            .matrix-input {
                width: 45px;
                height: 45px;
                font-size: 14px;
            }
            
            .size-btn {
                padding: 10px 15px;
                font-size: 16px;
            }
            
            h1 {
                font-size: 2rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üßÆ ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå</h1>
        
        <!-- Main Menu -->
        <div class="main-menu" id="mainMenu">
            <h2 style="text-align: center; color: #4a5568; margin-bottom: 25px;">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£</h2>
            <div class="function-buttons">
                <button class="function-btn" onclick="showFunction('determinant')">
                    <span class="btn-icon">üî¢</span>
                    <span class="btn-title">‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì Determinant</span>
                    <span class="btn-desc">‡πÉ‡∏™‡πà‡∏Ñ‡πà‡∏≤‡πÄ‡∏°‡∏ó‡∏£‡∏¥‡∏Å‡∏ã‡πå‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì determinant ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏ß‡∏¥‡∏ò‡∏µ‡∏ó‡∏≥</span>
                </button>
                <button class="function-btn" onclick="showFunction('cramer')">
                    <span class="btn-icon">üìê</span>
                    <span class="btn-title">‡πÅ‡∏Å‡πâ‡∏™‡∏°‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏¥‡∏á‡πÄ‡∏™‡πâ‡∏ô</span>
                    <span class="btn-desc">‡πÉ‡∏™‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏°‡∏Å‡∏≤‡∏£‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏Å‡πâ‡∏î‡πâ‡∏ß‡∏¢‡∏Å‡∏é‡∏Ç‡∏≠‡∏á Cramer</span>
                </button>
                <button class="function-btn" onclick="showFunction('spanning-tree')">
                    <span class="btn-icon">üå≥</span>
                    <span class="btn-title">‡∏ô‡∏±‡∏ö‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ï‡πâ‡∏ô‡πÑ‡∏°‡πâ</span>
                    <span class="btn-desc">‡πÉ‡∏™‡πà adjacency matrix ‡∏´‡∏£‡∏∑‡∏≠ Laplacian matrix ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏´‡∏≤‡∏à‡∏≥‡∏ô‡∏ß‡∏ô spanning trees</span>
                </button>
            </div>
        </div>

        <!-- Determinant Calculator -->
        <div class="function-section" id="determinantSection" style="display: none;">
            <div class="section-header">
                <button class="back-btn" onclick="showMainMenu()">‚Üê ‡∏Å‡∏•‡∏±‡∏ö</button>
                <h2>üî¢ ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì Determinant</h2>
            </div>
            
            <div class="size-buttons">
                <button class="size-btn" onclick="createMatrix(3)">3√ó3</button>
                <button class="size-btn" onclick="createMatrix(4)">4√ó4</button>
                <button class="size-btn" onclick="createMatrix(5)">5√ó5</button>
                <button class="size-btn" onclick="createMatrix(6)">6√ó6</button>
                <button class="size-btn" onclick="createMatrix(7)">7√ó7</button>
            </div>

            <div style="text-align: center; margin: 15px 0; color: #718096; font-size: 14px;">
                üí° <strong>‡πÄ‡∏Ñ‡∏•‡πá‡∏î‡∏•‡∏±‡∏ö:</strong> ‡πÉ‡∏ä‡πâ‡∏õ‡∏∏‡πà‡∏°‡∏•‡∏π‡∏Å‡∏®‡∏£ ‚Üë‚Üì‚Üê‚Üí ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏ä‡πà‡∏≠‡∏á ‡∏´‡∏£‡∏∑‡∏≠ Enter/Tab ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÑ‡∏õ‡∏ä‡πà‡∏≠‡∏á‡∏ñ‡∏±‡∏î‡πÑ‡∏õ<br>
                üéØ <strong>‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏:</strong> ‡∏Ñ‡∏•‡∏¥‡∏Å‡∏ä‡πà‡∏≠‡∏á‡πÅ‡∏•‡πâ‡∏ß 0 ‡∏à‡∏∞‡∏´‡∏≤‡∏¢‡πÑ‡∏õ ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏ä‡πà‡∏≠‡∏á‡πÇ‡∏î‡∏¢‡πÑ‡∏°‡πà‡πÉ‡∏™‡πà‡∏≠‡∏∞‡πÑ‡∏£‡∏à‡∏∞‡∏Å‡∏•‡∏±‡∏ö‡πÄ‡∏õ‡πá‡∏ô 0 ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
            </div>

            <div class="matrix-container" id="matrixContainer">
                <p style="text-align: center; color: #718096; font-size: 18px;">
                    ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ç‡∏ô‡∏≤‡∏î‡∏Ç‡∏≠‡∏á‡πÄ‡∏°‡∏ó‡∏£‡∏¥‡∏Å‡∏ã‡πå‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
                </p>
            </div>

            <div class="result" id="result"></div>
            
            <!-- Solution Steps -->
            <div class="solution-steps" id="solutionSteps" style="display: none;">
                <h3>üìù ‡∏ß‡∏¥‡∏ò‡∏µ‡∏ó‡∏≥</h3>
                <div id="detSteps"></div>
            </div>
            
            <!-- Error Checking -->
            <div class="error-checker" id="errorChecker" style="display: none;">
                <h3>üîç ‡πÑ‡∏•‡πà‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ú‡∏¥‡∏î</h3>
                <p>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö:</p>
                <div class="step-buttons" id="stepButtons"></div>
                <div id="stepResult"></div>
            </div>
        </div>

        <!-- Random Determinant Generator - REMOVED -->

        <!-- Cramer's Rule Solver -->
        <div class="function-section" id="cramerSection" style="display: none;">
            <div class="section-header">
                <button class="back-btn" onclick="showMainMenu()">‚Üê ‡∏Å‡∏•‡∏±‡∏ö</button>
                <h2>üìê ‡πÅ‡∏Å‡πâ‡∏™‡∏°‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏¥‡∏á‡πÄ‡∏™‡πâ‡∏ô (Cramer's Rule)</h2>
            </div>
            
            <div class="size-buttons">
                <button class="size-btn" onclick="createCramerSystem(2)">2 ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£</button>
                <button class="size-btn" onclick="createCramerSystem(3)">3 ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£</button>
                <button class="size-btn" onclick="createCramerSystem(4)">4 ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£</button>
                <button class="size-btn" onclick="createCramerSystem(5)">5 ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£</button>
                <button class="size-btn" onclick="createCramerSystem(6)">6 ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£</button>
                <button class="size-btn" onclick="createCramerSystem(7)">7 ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£</button>
            </div>
            
            <div class="equation-container" id="equationContainer">
                <p style="text-align: center; color: #718096; font-size: 18px;">
                    ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
                </p>
            </div>
            
            <div class="cramer-result" id="cramerResult"></div>
            
            <!-- Solution Steps for Cramer -->
            <div class="solution-steps" id="cramerSteps" style="display: none;">
                <h3>üìù ‡∏ß‡∏¥‡∏ò‡∏µ‡∏ó‡∏≥</h3>
                <div id="cramerSolutionSteps"></div>
            </div>
        </div>

        <!-- Spanning Tree Counter -->
        <div class="function-section" id="spanningTreeSection" style="display: none;">
            <div class="section-header">
                <button class="back-btn" onclick="showMainMenu()">‚Üê ‡∏Å‡∏•‡∏±‡∏ö</button>
                <h2>üå≥ ‡∏ô‡∏±‡∏ö‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ï‡πâ‡∏ô‡πÑ‡∏°‡πâ (Spanning Trees)</h2>
            </div>
            
            <div class="size-buttons">
                <button class="size-btn" onclick="createAdjacencyMatrix(3)">3 ‡∏à‡∏∏‡∏î‡∏¢‡∏≠‡∏î</button>
                <button class="size-btn" onclick="createAdjacencyMatrix(4)">4 ‡∏à‡∏∏‡∏î‡∏¢‡∏≠‡∏î</button>
                <button class="size-btn" onclick="createAdjacencyMatrix(5)">5 ‡∏à‡∏∏‡∏î‡∏¢‡∏≠‡∏î</button>
                <button class="size-btn" onclick="createAdjacencyMatrix(6)">6 ‡∏à‡∏∏‡∏î‡∏¢‡∏≠‡∏î</button>
                <button class="size-btn" onclick="createAdjacencyMatrix(7)">7 ‡∏à‡∏∏‡∏î‡∏¢‡∏≠‡∏î</button>
            </div>
            
            <div style="text-align: center; margin: 15px 0; color: #718096; font-size: 14px;">
                üí° <strong>‡∏ß‡∏¥‡∏ò‡∏µ‡πÉ‡∏™‡πà:</strong> ‡πÉ‡∏™‡πà 1 ‡∏´‡∏≤‡∏Å‡∏°‡∏µ‡πÄ‡∏™‡πâ‡∏ô‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏° ‡πÉ‡∏™‡πà 0 ‡∏´‡∏≤‡∏Å‡πÑ‡∏°‡πà‡∏°‡∏µ (‡πÄ‡∏°‡∏ó‡∏£‡∏¥‡∏Å‡∏ã‡πå‡∏™‡∏°‡∏°‡∏≤‡∏ï‡∏£)<br>
                üéØ <strong>‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏:</strong> ‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡πÅ‡∏¢‡∏á‡∏°‡∏∏‡∏°‡∏à‡∏∞‡πÄ‡∏õ‡πá‡∏ô 0 ‡πÄ‡∏™‡∏°‡∏≠
            </div>
            
            <div class="adjacency-container" id="adjacencyContainer">
                <p style="text-align: center; color: #718096; font-size: 18px;">
                    ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏à‡∏∏‡∏î‡∏¢‡∏≠‡∏î‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
                </p>
            </div>
            
            <div class="tree-result" id="treeResult"></div>
            
            <!-- Solution Steps for Spanning Tree -->
            <div class="solution-steps" id="treeSteps" style="display: none;">
                <h3>üìù ‡∏ß‡∏¥‡∏ò‡∏µ‡∏ó‡∏≥</h3>
                <div id="treeSolutionSteps"></div>
            </div>
        </div>
    </div>

    <script>
        let currentSize = 0;
        let currentInputIndex = 0;
        let matrixInputs = [];

        // Navigation functions
        function showMainMenu() {
            document.getElementById('mainMenu').style.display = 'block';
            document.getElementById('determinantSection').style.display = 'none';
            document.getElementById('cramerSection').style.display = 'none';
            document.getElementById('spanningTreeSection').style.display = 'none';
        }

        function showFunction(functionName) {
            document.getElementById('mainMenu').style.display = 'none';
            
            // Hide all sections
            document.getElementById('determinantSection').style.display = 'none';
            document.getElementById('cramerSection').style.display = 'none';
            document.getElementById('spanningTreeSection').style.display = 'none';
            
            // Show selected section
            switch(functionName) {
                case 'determinant':
                    document.getElementById('determinantSection').style.display = 'block';
                    break;
                case 'cramer':
                    document.getElementById('cramerSection').style.display = 'block';
                    break;
                case 'spanning-tree':
                    document.getElementById('spanningTreeSection').style.display = 'block';
                    break;
            }
        }

        // Determinant Calculator Functions
        function createMatrix(size) {
            currentSize = size;
            currentInputIndex = 0;
            matrixInputs = [];
            
            // Update active button
            document.querySelectorAll('#determinantSection .size-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');

            const container = document.getElementById('matrixContainer');
            
            // Create matrix table
            let html = '<table class="matrix-table">';
            
            for (let i = 0; i < size; i++) {
                html += '<tr>';
                for (let j = 0; j < size; j++) {
                    const index = i * size + j;
                    html += '<td><input type="text" class="matrix-input" id="input-' + index + '" onclick="setCurrentInput(' + index + ')" onkeydown="handleKeyDown(event, ' + index + ')" onkeyup="handleKeyUp(event, ' + index + ')" value="0"></td>';
                }
                html += '</tr>';
            }
            
            html += '</table>';
            html += '<div class="button-group">';
            html += '<button class="calculate-btn" onclick="calculateDeterminant()">‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì Determinant</button>';
            html += '<button class="clear-btn" onclick="clearDeterminantMatrix()">Clear</button>';
            html += '</div>';
            
            container.innerHTML = html;
            
            // Store input references and add blur event
            for (let i = 0; i < size * size; i++) {
                const input = document.getElementById('input-' + i);
                matrixInputs.push(input);
                
                // ‡πÄ‡∏û‡∏¥‡πà‡∏° event listener ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö blur (‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏ä‡πà‡∏≠‡∏á)
                input.addEventListener('blur', function() {
                    if (this.value === '') {
                        this.value = '0';
                    }
                });
            }
            
            // Set focus to first input
            setCurrentInput(0);
            
            // Hide result
            document.getElementById('result').style.display = 'none';
        }

        function setCurrentInput(index) {
            // Remove current-input class from all inputs
            matrixInputs.forEach(input => {
                input.classList.remove('current-input');
            });
            
            // Add current-input class to selected input
            if (matrixInputs[index]) {
                matrixInputs[index].classList.add('current-input');
                matrixInputs[index].focus();
                currentInputIndex = index;
                
                // ‡∏ñ‡πâ‡∏≤‡∏Ñ‡πà‡∏≤‡πÉ‡∏ô‡∏ä‡πà‡∏≠‡∏á‡πÄ‡∏õ‡πá‡∏ô "0" ‡πÉ‡∏´‡πâ‡∏•‡∏ö‡∏≠‡∏≠‡∏Å‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Ñ‡∏•‡∏¥‡∏Å
                if (matrixInputs[index].value === '0') {
                    matrixInputs[index].value = '';
                }
            }
        }

        function moveInput(direction) {
            if (matrixInputs.length === 0) return;
            
            const currentRow = Math.floor(currentInputIndex / currentSize);
            const currentCol = currentInputIndex % currentSize;
            let newIndex = currentInputIndex;
            
            switch (direction) {
                case 'right':
                    if (currentCol < currentSize - 1) {
                        newIndex = currentRow * currentSize + currentCol + 1;
                    }
                    break;
                case 'left':
                    if (currentCol > 0) {
                        newIndex = currentRow * currentSize + currentCol - 1;
                    }
                    break;
                case 'down':
                    if (currentRow < currentSize - 1) {
                        newIndex = (currentRow + 1) * currentSize + currentCol;
                    }
                    break;
                case 'up':
                    if (currentRow > 0) {
                        newIndex = (currentRow - 1) * currentSize + currentCol;
                    }
                    break;
            }
            
            setCurrentInput(newIndex);
        }

        function nextInput() {
            if (matrixInputs.length === 0) return;
            
            const nextIndex = (currentInputIndex + 1) % matrixInputs.length;
            setCurrentInput(nextIndex);
        }

        function handleKeyDown(event, index) {
            // Prevent default behavior for arrow keys to avoid cursor movement
            if (['ArrowUp', 'ArrowDown', 'ArrowLeft', 'ArrowRight'].includes(event.key)) {
                event.preventDefault();
            }
        }

        function handleKeyUp(event, index) {
            if (event.key === 'Enter' || event.key === 'Tab') {
                event.preventDefault();
                nextInput();
            } else if (event.key === 'ArrowRight') {
                event.preventDefault();
                moveInput('right');
            } else if (event.key === 'ArrowLeft') {
                event.preventDefault();
                moveInput('left');
            } else if (event.key === 'ArrowDown') {
                event.preventDefault();
                moveInput('down');
            } else if (event.key === 'ArrowUp') {
                event.preventDefault();
                moveInput('up');
            }
        }

        function calculateDeterminant() {
            console.log('calculateDeterminant called');
            if (matrixInputs.length === 0) {
                showResult('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ç‡∏ô‡∏≤‡∏î‡πÄ‡∏°‡∏ó‡∏£‡∏¥‡∏Å‡∏ã‡πå‡∏Å‡πà‡∏≠‡∏ô', true);
                return;
            }

            // Get matrix values
            const matrix = [];
            for (let i = 0; i < currentSize; i++) {
                matrix[i] = [];
                for (let j = 0; j < currentSize; j++) {
                    const value = matrixInputs[i * currentSize + j].value;
                    // ‡∏ñ‡πâ‡∏≤‡∏ä‡πà‡∏≠‡∏á‡∏ß‡πà‡∏≤‡∏á‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏ï‡∏£‡∏¥‡∏á‡∏ß‡πà‡∏≤‡∏á ‡πÉ‡∏´‡πâ‡∏ñ‡∏∑‡∏≠‡πÄ‡∏õ‡πá‡∏ô 0
                    const numValue = (value === '' || value === null || value === undefined) ? 0 : parseFloat(value);
                    if (isNaN(numValue)) {
                        showResult('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á', true);
                        return;
                    }
                    matrix[i][j] = numValue;
                }
            }

            try {
                const det = determinant(matrix);
                
                console.log('Determinant calculated:', det);
                
                // ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏®‡∏©‡∏™‡πà‡∏ß‡∏ô
                const resultText = formatAsFraction(det);
                showResult('Determinant = ' + resultText, false);
                
            } catch (error) {
                console.error('Error in calculateDeterminant:', error);
                showResult('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì: ' + error.message, true);
            }
        }

        function clearDeterminantMatrix() {
            console.log('clearDeterminantMatrix called, currentSize:', currentSize);
            const size = currentSize;
            
            // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏Ñ‡πà‡∏≤‡∏ó‡∏∏‡∏Å‡∏ä‡πà‡∏≠‡∏á‡πÄ‡∏õ‡πá‡∏ô 0
            for (let i = 0; i < size * size; i++) {
                const input = document.getElementById('input-' + i);
                if (input) {
                    input.value = '0';
                    console.log('Reset input-' + i + ' to 0');
                } else {
                    console.log('Input not found: input-' + i);
                }
            }
            
            // ‡∏ã‡πà‡∏≠‡∏ô‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå
            const resultElement = document.getElementById('result');
            if (resultElement) {
                resultElement.style.display = 'none';
                console.log('Hidden result element');
            }
        }

        function determinantWithSteps(matrix, steps) {
            const n = matrix.length;
            
            if (n === 1) {
                steps.push('‡πÄ‡∏°‡∏ó‡∏£‡∏¥‡∏Å‡∏ã‡πå 1√ó1: det = ' + matrix[0][0]);
                return matrix[0][0];
            }
            
            if (n === 2) {
                const result = matrix[0][0] * matrix[1][1] - matrix[0][1] * matrix[1][0];
                steps.push('‡πÄ‡∏°‡∏ó‡∏£‡∏¥‡∏Å‡∏ã‡πå 2√ó2: det = (' + matrix[0][0] + ')(' + matrix[1][1] + ') - (' + matrix[0][1] + ')(' + matrix[1][0] + ') = ' + result);
                return result;
            }
            
            steps.push('‡∏Ç‡∏¢‡∏≤‡∏¢‡∏ï‡∏≤‡∏°‡πÅ‡∏ñ‡∏ß‡∏ó‡∏µ‡πà 1:');
            let det = 0;
            for (let j = 0; j < n; j++) {
                const minor = getMinor(matrix, 0, j);
                const minorDet = determinantWithSteps(minor, steps);
                const cofactor = Math.pow(-1, j) * matrix[0][j] * minorDet;
                det += cofactor;
                
                const sign = j % 2 === 0 ? '+' : '-';
                steps.push('‡∏≠‡∏á‡∏Ñ‡πå‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö (' + (j+1) + '): ' + sign + '(' + matrix[0][j] + ') √ó ' + minorDet + ' = ' + cofactor);
            }
            
            steps.push('‡∏ú‡∏•‡∏£‡∏ß‡∏°: ' + det);
            return det;
        }

        function formatAsFraction(decimal) {
            if (Number.isInteger(decimal)) {
                return decimal.toString();
            }
            
            // ‡πÅ‡∏õ‡∏•‡∏á‡∏ó‡∏®‡∏ô‡∏¥‡∏¢‡∏°‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏®‡∏©‡∏™‡πà‡∏ß‡∏ô
            const tolerance = 1.0E-10;
            let h1 = 1, h2 = 0, k1 = 0, k2 = 1;
            let b = decimal;
            
            do {
                const a = Math.floor(b);
                let aux = h1;
                h1 = a * h1 + h2;
                h2 = aux;
                aux = k1;
                k1 = a * k1 + k2;
                k2 = aux;
                b = 1 / (b - a);
            } while (Math.abs(decimal - h1 / k1) > decimal * tolerance);
            
            if (k1 === 1) {
                return h1.toString();
            }
            
            return '<span class="fraction"><span class="numerator">' + h1 + '</span><span class="denominator">' + k1 + '</span></span>';
        }

        function showSolutionSteps(steps, containerId) {
            const container = document.getElementById(containerId);
            let html = '';
            
            steps.forEach((step, index) => {
                html += '<div class="step">‡∏Ç‡∏±‡πâ‡∏ô‡∏ó‡∏µ‡πà ' + (index + 1) + ': ' + step + '</div>';
            });
            
            container.innerHTML = html;
            document.getElementById('solutionSteps').style.display = 'block';
        }

        function setupErrorChecker(matrix, steps) {
            const buttons = document.getElementById('stepButtons');
            let html = '';
            
            steps.forEach((step, index) => {
                html += '<button class="step-btn" onclick="checkStep(' + index + ')">';
                html += '‡∏Ç‡∏±‡πâ‡∏ô‡∏ó‡∏µ‡πà ' + (index + 1) + '</button>';
            });
            
            buttons.innerHTML = html;
            document.getElementById('errorChecker').style.display = 'block';
            
            // ‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏ß‡πâ‡πÉ‡∏ä‡πâ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö
            window.currentMatrix = matrix;
            window.currentSteps = steps;
        }

        function checkStep(stepIndex) {
            // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏µ‡∏õ‡∏∏‡πà‡∏°
            document.querySelectorAll('.step-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.step-btn')[stepIndex].classList.add('active');
            
            const resultDiv = document.getElementById('stepResult');
            const step = window.currentSteps[stepIndex];
            
            resultDiv.innerHTML = '<div class="step"><strong>‡∏Ç‡∏±‡πâ‡∏ô‡∏ó‡∏µ‡πà ' + (stepIndex + 1) + ':</strong><br>' + 
                                step + '<br><br>' +
                                '<small>üí° ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà ‡∏´‡∏≤‡∏Å‡∏ú‡∏¥‡∏î‡πÉ‡∏´‡πâ‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</small></div>';
        }

        function showResult(message, isError) {
            const result = document.getElementById('result');
            result.textContent = message;
            result.className = isError ? 'result error' : 'result';
            result.style.display = 'block';
            
            // Scroll to result
            result.scrollIntoView({ behavior: 'smooth' });
        }

        // Cramer's Rule Functions
        let currentCramerSize = 0;
        let coefficientInputs = [];
        let constantInputs = [];

        function createCramerSystem(size) {
            currentCramerSize = size;
            coefficientInputs = [];
            constantInputs = [];
            
            // Update active button
            document.querySelectorAll('#cramerSection .size-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');

            const container = document.getElementById('equationContainer');
            const variables = ['x‚ÇÅ', 'x‚ÇÇ', 'x‚ÇÉ', 'x‚ÇÑ', 'x‚ÇÖ', 'x‚ÇÜ', 'x‚Çá'];
            
            let html = '<div style="margin: 20px 0;">';
            html += '<h4>‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏°‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏¥‡∏á‡πÄ‡∏™‡πâ‡∏ô ' + size + ' ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£:</h4>';
            
            for (let i = 0; i < size; i++) {
                html += '<div class="equation-row">';
                
                // ‡∏™‡∏±‡∏°‡∏õ‡∏£‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå
                for (let j = 0; j < size; j++) {
                    const inputId = 'coeff-' + i + '-' + j;
                    if (j > 0) html += ' + ';
                    html += '<input type="text" class="equation-input" id="' + inputId + '" value="0" onblur="if(this.value===\'\') this.value=\'0\'" onclick="if(this.value===\'0\') this.value=\'\'" onkeydown="handleCramerKeyNavigation(event, ' + i + ', ' + j + ', ' + size + ', false)">';
                    html += variables[j];
                    
                    coefficientInputs.push(inputId);
                }
                
                html += ' = ';
                
                // ‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏á‡∏ó‡∏µ‡πà
                const constId = 'const-' + i;
                html += '<input type="text" class="equation-input" id="' + constId + '" value="0" onblur="if(this.value===\'\') this.value=\'0\'" onclick="if(this.value===\'0\') this.value=\'\'" onkeydown="handleCramerKeyNavigation(event, ' + i + ', -1, ' + size + ', true)">';
                constantInputs.push(constId);
                
                html += '</div>';
            }
            
            html += '</div>';
            html += '<div class="button-group">';
            html += '<button class="calculate-btn" onclick="solveCramerSystem()">‡πÅ‡∏Å‡πâ‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏°‡∏Å‡∏≤‡∏£</button>';
            html += '<button class="clear-btn" onclick="clearCramerMatrix()">Clear</button>';
            html += '</div>';
            
            container.innerHTML = html;
            
            // Hide results
            document.getElementById('cramerResult').style.display = 'none';
            document.getElementById('cramerSteps').style.display = 'none';
        }

        function handleCramerKeyNavigation(event, row, col, size, isConstant) {
            if (event.key === 'ArrowUp') {
                event.preventDefault();
                if (row > 0) {
                    if (isConstant) {
                        const newId = 'const-' + (row - 1);
                        const newInput = document.getElementById(newId);
                        newInput.focus();
                        if (newInput.value === '0') newInput.value = '';
                    } else {
                        const newId = 'coeff-' + (row - 1) + '-' + col;
                        const newInput = document.getElementById(newId);
                        newInput.focus();
                        if (newInput.value === '0') newInput.value = '';
                    }
                }
            } else if (event.key === 'ArrowDown') {
                event.preventDefault();
                if (row < size - 1) {
                    if (isConstant) {
                        const newId = 'const-' + (row + 1);
                        const newInput = document.getElementById(newId);
                        newInput.focus();
                        if (newInput.value === '0') newInput.value = '';
                    } else {
                        const newId = 'coeff-' + (row + 1) + '-' + col;
                        const newInput = document.getElementById(newId);
                        newInput.focus();
                        if (newInput.value === '0') newInput.value = '';
                    }
                }
            } else if (event.key === 'ArrowLeft') {
                event.preventDefault();
                if (isConstant) {
                    // ‡∏à‡∏≤‡∏Å‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏á‡∏ó‡∏µ‡πà‡πÑ‡∏õ‡∏ó‡∏µ‡πà‡∏™‡∏±‡∏°‡∏õ‡∏£‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏ï‡∏±‡∏ß‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢
                    const newId = 'coeff-' + row + '-' + (size - 1);
                    const newInput = document.getElementById(newId);
                    newInput.focus();
                    if (newInput.value === '0') newInput.value = '';
                } else if (col > 0) {
                    const newId = 'coeff-' + row + '-' + (col - 1);
                    const newInput = document.getElementById(newId);
                    newInput.focus();
                    if (newInput.value === '0') newInput.value = '';
                }
            } else if (event.key === 'ArrowRight' || event.key === 'Enter') {
                event.preventDefault();
                if (isConstant) {
                    // ‡∏à‡∏≤‡∏Å‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏á‡∏ó‡∏µ‡πà‡πÑ‡∏õ‡πÅ‡∏ñ‡∏ß‡∏ñ‡∏±‡∏î‡πÑ‡∏õ
                    if (row < size - 1) {
                        const newId = 'coeff-' + (row + 1) + '-0';
                        const newInput = document.getElementById(newId);
                        newInput.focus();
                        if (newInput.value === '0') newInput.value = '';
                    }
                } else if (col < size - 1) {
                    // ‡πÑ‡∏õ‡∏™‡∏±‡∏°‡∏õ‡∏£‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏ñ‡∏±‡∏î‡πÑ‡∏õ‡πÉ‡∏ô‡πÅ‡∏ñ‡∏ß‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô
                    const newId = 'coeff-' + row + '-' + (col + 1);
                    const newInput = document.getElementById(newId);
                    newInput.focus();
                    if (newInput.value === '0') newInput.value = '';
                } else {
                    // ‡πÑ‡∏õ‡∏ó‡∏µ‡πà‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏á‡∏ó‡∏µ‡πà
                    const newId = 'const-' + row;
                    const newInput = document.getElementById(newId);
                    newInput.focus();
                    if (newInput.value === '0') newInput.value = '';
                }
            }
        }

        function solveCramerSystem() {
            if (coefficientInputs.length === 0) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡∏Å‡πà‡∏≠‡∏ô');
                return;
            }

            // ‡∏≠‡πà‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å input
            const n = currentCramerSize;
            const A = Array(n).fill().map(() => Array(n).fill(0));
            const b = Array(n).fill(0);
            const variables = ['x‚ÇÅ', 'x‚ÇÇ', 'x‚ÇÉ', 'x‚ÇÑ', 'x‚ÇÖ', 'x‚ÇÜ', 'x‚Çá'];

            // ‡∏≠‡πà‡∏≤‡∏ô‡πÄ‡∏°‡∏ó‡∏£‡∏¥‡∏Å‡∏ã‡πå A
            for (let i = 0; i < n; i++) {
                for (let j = 0; j < n; j++) {
                    const value = document.getElementById('coeff-' + i + '-' + j).value;
                    A[i][j] = parseFloat(value) || 0;
                }
                // ‡∏≠‡πà‡∏≤‡∏ô‡πÄ‡∏ß‡∏Å‡πÄ‡∏ï‡∏≠‡∏£‡πå b
                const constValue = document.getElementById('const-' + i).value;
                b[i] = parseFloat(constValue) || 0;
            }

            // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì det(A)
            const detA = computeDeterminant(A);
            
            if (Math.abs(detA) < 1e-12) {
                document.getElementById('cramerResult').innerHTML = 
                    '<div class="answer-box" style="background: linear-gradient(45deg, #fc8181, #f56565);">' +
                    '‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏°‡∏Å‡∏≤‡∏£‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡πÄ‡∏î‡∏µ‡∏¢‡∏ß (det(A) = 0)</div>';
                document.getElementById('cramerResult').style.display = 'block';
                return;
            }

            // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏î‡πâ‡∏ß‡∏¢ Cramer's Rule
            const solutions = [];

            // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£
            for (let i = 0; i < n; i++) {
                // ‡∏™‡∏£‡πâ‡∏≤‡∏á Ai ‡πÇ‡∏î‡∏¢‡πÅ‡∏ó‡∏ô‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡∏ó‡∏µ‡πà i ‡∏î‡πâ‡∏ß‡∏¢ b
                const Ai = A.map(row => [...row]); // deep copy
                for (let j = 0; j < n; j++) {
                    Ai[j][i] = b[j];
                }
                
                const detAi = computeDeterminant(Ai);
                const xi = detAi / detA;
                solutions.push(xi);
            }

            // ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå
            let html = '<div class="answer-box">';
            html += '<strong>‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏Ç‡∏≠‡∏á‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏°‡∏Å‡∏≤‡∏£:</strong><br><br>';
            
            for (let i = 0; i < n; i++) {
                const exactValue = solutions[i];
                const roundedValue = Math.round(exactValue * 1000000) / 1000000; // ‡∏õ‡∏±‡∏î‡πÄ‡∏®‡∏© 6 ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á
                
                // ‡πÅ‡∏õ‡∏•‡∏á‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏®‡∏©‡∏™‡πà‡∏ß‡∏ô
                const fraction = decimalToFraction(exactValue);
                const fractionStr = formatFraction(fraction.numerator, fraction.denominator);
                
                html += '<div style="margin: 8px 0; padding: 5px; background: rgba(255,255,255,0.3); border-radius: 5px;">';
                html += '<strong>' + variables[i] + '</strong> = ';
                
                // ‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏®‡∏©‡∏™‡πà‡∏ß‡∏ô‡∏ñ‡πâ‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏á‡πà‡∏≤‡∏¢ (‡∏ï‡∏±‡∏ß‡∏™‡πà‡∏ß‡∏ô‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô 1000)
                if (fraction.denominator <= 1000 && fraction.denominator > 1) {
                    html += '<span style="color: #2d3748; font-weight: bold;">' + fractionStr + '</span>';
                    html += ' = <span style="color: #4a5568;">' + roundedValue + '</span>';
                } else {
                    html += '<span style="color: #2d3748; font-weight: bold;">' + roundedValue + '</span>';
                }
                
                html += '</div>';
            }
            
            html += '</div>';

            document.getElementById('cramerResult').innerHTML = html;
            document.getElementById('cramerResult').style.display = 'block';
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì determinant ‡πÅ‡∏ö‡∏ö‡πÉ‡∏´‡∏°‡πà (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Cramer's Rule)
        function computeDeterminant(matrix) {
            const n = matrix.length;
            
            // ‡∏™‡∏£‡πâ‡∏≤‡∏á copy ‡∏Ç‡∏≠‡∏á matrix
            let A = matrix.map(row => [...row]);
            
            let det = 1;
            let swaps = 0;
            
            // Gaussian elimination
            for (let i = 0; i < n; i++) {
                // ‡∏´‡∏≤ pivot
                let maxRow = i;
                for (let k = i + 1; k < n; k++) {
                    if (Math.abs(A[k][i]) > Math.abs(A[maxRow][i])) {
                        maxRow = k;
                    }
                }
                
                // ‡∏™‡∏•‡∏±‡∏ö‡πÅ‡∏ñ‡∏ß
                if (maxRow !== i) {
                    [A[i], A[maxRow]] = [A[maxRow], A[i]];
                    swaps++;
                }
                
                // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö diagonal element
                if (Math.abs(A[i][i]) < 1e-12) {
                    return 0;
                }
                
                det *= A[i][i];
                
                // Elimination
                for (let k = i + 1; k < n; k++) {
                    const factor = A[k][i] / A[i][i];
                    for (let j = i; j < n; j++) {
                        A[k][j] -= factor * A[i][j];
                    }
                }
            }
            
            return swaps % 2 === 0 ? det : -det;
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÅ‡∏õ‡∏•‡∏á‡∏ó‡∏®‡∏ô‡∏¥‡∏¢‡∏°‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏®‡∏©‡∏™‡πà‡∏ß‡∏ô
        function decimalToFraction(decimal, tolerance = 1e-6) {
            if (Math.abs(decimal) < tolerance) return { numerator: 0, denominator: 1 };
            
            let sign = decimal < 0 ? -1 : 1;
            decimal = Math.abs(decimal);
            
            // ‡∏´‡∏≤‡πÄ‡∏®‡∏©‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡πÉ‡∏Å‡∏•‡πâ‡πÄ‡∏Ñ‡∏µ‡∏¢‡∏á‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î‡∏î‡πâ‡∏ß‡∏¢ continued fraction algorithm
            let h1 = 1, h2 = 0, k1 = 0, k2 = 1;
            let b = decimal;
            
            do {
                let a = Math.floor(b);
                let aux = h1; h1 = a * h1 + h2; h2 = aux;
                aux = k1; k1 = a * k1 + k2; k2 = aux;
                b = 1 / (b - a);
            } while (Math.abs(decimal - h1/k1) > tolerance && k1 <= 10000);
            
            return { numerator: sign * h1, denominator: k1 };
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏®‡∏©‡∏™‡πà‡∏ß‡∏ô‡πÉ‡∏ô‡∏£‡∏π‡∏õ‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏á‡πà‡∏≤‡∏¢
        function formatFraction(numerator, denominator) {
            if (denominator === 1) return numerator.toString();
            if (denominator === 0) return 'undefined';
            
            // ‡∏´‡∏≤‡∏£ common divisor
            const gcd = (a, b) => b === 0 ? a : gcd(b, a % b);
            const divisor = gcd(Math.abs(numerator), Math.abs(denominator));
            
            numerator /= divisor;
            denominator /= divisor;
            
            if (denominator < 0) {
                numerator = -numerator;
                denominator = -denominator;
            }
            
            return numerator + '/' + denominator;
        }

        function clearCramerMatrix() {
            console.log('clearCramerMatrix called, currentCramerSize:', currentCramerSize);
            const n = currentCramerSize;
            
            // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏Ñ‡πà‡∏≤‡πÄ‡∏°‡∏ó‡∏£‡∏¥‡∏Å‡∏ã‡πå‡∏™‡∏±‡∏°‡∏õ‡∏£‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå
            for (let i = 0; i < n; i++) {
                for (let j = 0; j < n; j++) {
                    const input = document.getElementById('coeff-' + i + '-' + j);
                    if (input) {
                        input.value = '0';
                        console.log('Reset coeff-' + i + '-' + j + ' to 0');
                    } else {
                        console.log('Input not found: coeff-' + i + '-' + j);
                    }
                }
            }
            
            // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏Ñ‡πà‡∏≤‡πÄ‡∏ß‡∏Å‡πÄ‡∏ï‡∏≠‡∏£‡πå‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö
            for (let i = 0; i < n; i++) {
                const input = document.getElementById('const-' + i);
                if (input) {
                    input.value = '0';
                    console.log('Reset const-' + i + ' to 0');
                } else {
                    console.log('Input not found: const-' + i);
                }
            }
            
            // ‡∏ã‡πà‡∏≠‡∏ô‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå
            const cramerResult = document.getElementById('cramerResult');
            const cramerSteps = document.getElementById('cramerSteps');
            if (cramerResult) cramerResult.style.display = 'none';
            if (cramerSteps) cramerSteps.style.display = 'none';
            console.log('Hidden Cramer results');
        }

        // Spanning Tree Functions
        let currentTreeSize = 0;
        let adjacencyInputs = [];

        function createAdjacencyMatrix(size) {
            currentTreeSize = size;
            adjacencyInputs = [];
            
            // Update active button
            document.querySelectorAll('#spanningTreeSection .size-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');

            const container = document.getElementById('adjacencyContainer');
            
            let html = '<h4>Matrix Input (' + size + '√ó' + size + '):</h4>';
            html += '<p style="font-size: 14px; color: #666; margin: 10px 0;">‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏Å‡∏£‡∏≠‡∏Å Adjacency Matrix (0,1) ‡∏´‡∏£‡∏∑‡∏≠ Laplacian Matrix (‡∏£‡∏ß‡∏° -1) ‡πÑ‡∏î‡πâ</p>';
            html += '<table class="matrix-table">';
            
            for (let i = 0; i < size; i++) {
                html += '<tr>';
                for (let j = 0; j < size; j++) {
                    const index = i * size + j;
                    const inputId = 'adj-' + i + '-' + j;
                    
                    // ‡πÉ‡∏´‡πâ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏Å‡∏£‡∏≠‡∏Å‡πÑ‡∏î‡πâ‡∏ó‡∏∏‡∏Å‡∏ä‡πà‡∏≠‡∏á
                    html += '<td><input type="text" class="matrix-input" id="' + inputId + '" value="0" onclick="if(this.value===\'0\') this.value=\'\'" onblur="if(this.value===\'\') this.value=\'0\'" onkeydown="handleAdjacencyKeyNavigation(event, ' + i + ', ' + j + ', ' + size + ')"></td>';
                    
                    adjacencyInputs.push(inputId);
                }
                html += '</tr>';
            }
            
            html += '</table>';
            html += '<div class="button-group">';
            html += '<button class="calculate-btn" onclick="calculateSpanningTrees()">‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ï‡πâ‡∏ô‡πÑ‡∏°‡πâ</button>';
            html += '<button class="clear-btn" onclick="clearSpanningTreeMatrix()">Clear</button>';
            html += '</div>';
            
            container.innerHTML = html;
            
            // Hide results
            document.getElementById('treeResult').style.display = 'none';
            document.getElementById('treeSteps').style.display = 'none';
        }

        function handleAdjacencyKeyNavigation(event, row, col, size) {
            if (event.key === 'ArrowUp') {
                event.preventDefault();
                if (row > 0) {
                    const newId = 'adj-' + (row - 1) + '-' + col;
                    const newInput = document.getElementById(newId);
                    newInput.focus();
                    if (newInput.value === '0') newInput.value = '';
                }
            } else if (event.key === 'ArrowDown') {
                event.preventDefault();
                if (row < size - 1) {
                    const newId = 'adj-' + (row + 1) + '-' + col;
                    const newInput = document.getElementById(newId);
                    newInput.focus();
                    if (newInput.value === '0') newInput.value = '';
                }
            } else if (event.key === 'ArrowLeft') {
                event.preventDefault();
                if (col > 0) {
                    const newId = 'adj-' + row + '-' + (col - 1);
                    const newInput = document.getElementById(newId);
                    newInput.focus();
                    if (newInput.value === '0') newInput.value = '';
                }
            } else if (event.key === 'ArrowRight' || event.key === 'Enter') {
                event.preventDefault();
                if (col < size - 1) {
                    // ‡πÑ‡∏õ‡∏ä‡πà‡∏≠‡∏á‡∏ñ‡∏±‡∏î‡πÑ‡∏õ‡πÉ‡∏ô‡πÅ‡∏ñ‡∏ß‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô
                    const newId = 'adj-' + row + '-' + (col + 1);
                    const newInput = document.getElementById(newId);
                    newInput.focus();
                    if (newInput.value === '0') newInput.value = '';
                } else if (row < size - 1) {
                    // ‡πÑ‡∏õ‡∏ä‡πà‡∏≠‡∏á‡πÅ‡∏£‡∏Å‡∏Ç‡∏≠‡∏á‡πÅ‡∏ñ‡∏ß‡∏ñ‡∏±‡∏î‡πÑ‡∏õ
                    const newId = 'adj-' + (row + 1) + '-0';
                    const newInput = document.getElementById(newId);
                    newInput.focus();
                    if (newInput.value === '0') newInput.value = '';
                }
            }
        }

        function calculateSpanningTrees() {
            if (adjacencyInputs.length === 0) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏à‡∏∏‡∏î‡∏¢‡∏≠‡∏î‡∏Å‡πà‡∏≠‡∏ô');
                return;
            }

            // Get adjacency matrix
            const adj = [];
            for (let i = 0; i < currentTreeSize; i++) {
                adj[i] = [];
                for (let j = 0; j < currentTreeSize; j++) {
                    const value = document.getElementById('adj-' + i + '-' + j).value;
                    adj[i][j] = (value === '' || value === null) ? 0 : parseInt(value);
                    if (isNaN(adj[i][j])) {
                        alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á');
                        return;
                    }
                }
            }
            
            // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ input ‡πÄ‡∏õ‡πá‡∏ô Adjacency Matrix ‡∏´‡∏£‡∏∑‡∏≠ Laplacian Matrix
            let isLaplacian = false;
            for (let i = 0; i < currentTreeSize; i++) {
                for (let j = 0; j < currentTreeSize; j++) {
                    if (adj[i][j] < 0) {
                        isLaplacian = true;
                        break;
                    }
                }
                if (isLaplacian) break;
            }
            
            let laplacian = [];
            
            if (isLaplacian) {
                // ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô Laplacian Matrix ‡πÅ‡∏•‡πâ‡∏ß ‡πÉ‡∏ä‡πâ‡πÄ‡∏•‡∏¢
                laplacian = adj.map(row => [...row]); // copy array
            } else {
                // ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô Adjacency Matrix ‡πÉ‡∏´‡πâ‡πÅ‡∏õ‡∏•‡∏á‡πÄ‡∏õ‡πá‡∏ô Laplacian
                for (let i = 0; i < currentTreeSize; i++) {
                    laplacian[i] = [];
                    for (let j = 0; j < currentTreeSize; j++) {
                        if (i === j) {
                            // Diagonal: degree of vertex i
                            let degree = 0;
                            for (let k = 0; k < currentTreeSize; k++) {
                                degree += adj[i][k];
                            }
                            laplacian[i][j] = degree;
                        } else {
                            laplacian[i][j] = -adj[i][j];
                        }
                    }
                }
            }

            // Remove last row and column (Matrix-Tree Theorem)
            const cofactor = [];
            for (let i = 0; i < currentTreeSize - 1; i++) {
                cofactor[i] = [];
                for (let j = 0; j < currentTreeSize - 1; j++) {
                    cofactor[i][j] = laplacian[i][j];
                }
            }

            const spanningTrees = Math.abs(Math.round(determinant(cofactor)));

            // Display results
            let html = '<div class="answer-box">';
            html += '‡∏à‡∏≥‡∏ô‡∏ß‡∏ô Spanning Trees = ' + spanningTrees + ' ‡∏ï‡πâ‡∏ô';
            html += '</div>';

            document.getElementById('treeResult').innerHTML = html;
            document.getElementById('treeResult').style.display = 'block';
        }

        function clearSpanningTreeMatrix() {
            console.log('clearSpanningTreeMatrix called, currentTreeSize:', currentTreeSize);
            const size = currentTreeSize;
            
            // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏Ñ‡πà‡∏≤‡∏ó‡∏∏‡∏Å‡∏ä‡πà‡∏≠‡∏á‡πÉ‡∏ô adjacency matrix ‡πÄ‡∏õ‡πá‡∏ô 0
            for (let i = 0; i < size; i++) {
                for (let j = 0; j < size; j++) {
                    const input = document.getElementById('adj-' + i + '-' + j);
                    if (input) {
                        input.value = '0';
                        console.log('Reset adj-' + i + '-' + j + ' to 0');
                    } else {
                        console.log('Input not found: adj-' + i + '-' + j);
                    }
                }
            }
            
            // ‡∏ã‡πà‡∏≠‡∏ô‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå
            const treeResult = document.getElementById('treeResult');
            const treeSteps = document.getElementById('treeSteps');
            if (treeResult) treeResult.style.display = 'none';
            if (treeSteps) treeSteps.style.display = 'none';
            console.log('Hidden tree results');
        }

        // Helper function for determinant calculation (keep original)
        function determinant(matrix) {
            const n = matrix.length;
            
            if (n === 1) {
                return matrix[0][0];
            }
            
            if (n === 2) {
                return matrix[0][0] * matrix[1][1] - matrix[0][1] * matrix[1][0];
            }
            
            let det = 0;
            for (let j = 0; j < n; j++) {
                const minor = getMinor(matrix, 0, j);
                const cofactor = Math.pow(-1, j) * matrix[0][j] * determinant(minor);
                det += cofactor;
            }
            
            return det;
        }

        function getMinor(matrix, row, col) {
            const n = matrix.length;
            const minor = [];
            
            for (let i = 0; i < n; i++) {
                if (i === row) continue;
                const newRow = [];
                for (let j = 0; j < n; j++) {
                    if (j === col) continue;
                    newRow.push(matrix[i][j]);
                }
                minor.push(newRow);
            }
            
            return minor;
        }

        // Initialize with main menu
        window.onload = function() {
            showMainMenu();
        };
    </script>
</body>
</html>